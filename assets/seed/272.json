{"id": "272", "type": "class", "data": "{\"code_str\": \"class TreeView:\\n    def __init__(self, top_level_items=None, builder=None,\\n                 indentation=2.0,\\n                 focus_parent=world.focus):\\n        self.top_level_items = top_level_items or []\\n        self.builder = builder or self.default_builder\\n        self.indentation = indentation\\n        self.focus = focus_parent.add_child(self)\\n        self.objs = []\\n        self.items = []\\n        self.layout = z.Layout(\\n            name='tree-view', measurer=self.measurer,\\n            layouter=self.layouter)\\n        self.update_items()\\n\\n    def default_builder(self, item, context):\\n        return z.ContextButton(\\n            label=str(item)[:100],\\n            focus_parent=context['focus_parent']\\n        )\\n\\n    def set_top_level_items(self, items):\\n        self.top_level_items = items\\n        self.update_items()\\n\\n    def update_items(self):\\n        self.clear()\\n        stack = [(item, 0) for item in reversed(self.top_level_items)]\\n        while stack:\\n            tree_item, level = stack.pop()\\n            self.items.append((tree_item, level))\\n            item_obj = self.builder(tree_item.item, {'focus_parent': self.focus, 'level': level})\\n            obj = z.TreeViewRow(self, tree_item, item_obj)\\n            self.objs.append(obj)\\n            if hasattr(tree_item, 'children') and tree_item.expanded:\\n                stack.extend((child, level + 1) for child in reversed(tree_item.children))\\n        self.layout.set_children([x.layout for x in self.objs])\\n\\n    def measurer(self):\\n        if self.layout.children:\\n            [child.measurer() for child in self.layout.children]\\n            self.layout.measure[0] = max(child.measure[0] + self.indentation * level for child, (_, level) in zip(self.layout.children, self.items))\\n            self.layout.measure[1] = sum(child.measure[1] for child in self.layout.children)\\n            self.layout.measure[2] = max(child.measure[2] for child in self.layout.children)\\n\\n    def layouter(self):\\n        if not self.layout.children:\\n            return\\n        y_offset = 0\\n        for i, child in enumerate(self.layout.children):\\n            child.depth_offset_index = self.layout.depth_offset_index\\n\\n            level = self.items[i][1]\\n            x_offset = level * self.indentation\\n\\n            child.size = child.measure.copy()\\n            child.size[0] = self.layout.size[0] - x_offset\\n            \\n            child.position = self.layout.position + [x_offset, 0, 0]\\n            child.position[1] = self.layout.position[1] + self.layout.size[1] - y_offset - child.size[1]\\n            child.rotation = self.layout.rotation.copy()\\n            child.layouter()\\n            \\n            y_offset += child.size[1]\\n\\n    def clear(self):\\n        self.layout.clear_children()\\n        for obj in self.objs:\\n            obj.drop()\\n        self.objs.clear()\\n        self.items.clear()\\n\\n    def drop(self):\\n        self.layout.drop()\\n        for obj in self.objs:\\n            obj.drop()\\n        self.objs.clear()\\n        if self.focus:\\n            self.focus.drop()\\n\", \"name\": \"TreeView\"}", "created_at": null, "updated_at": 1754239007.5043037}