{"id": "270", "type": "class", "data": "{\"code_str\": \"import time\\n\\nclass Tasks:\\n    def __init__(self):\\n        self.inbox_task_id = 56\\n\\n    def create_task(self, label, points, parent):\\n        \\\"\\\"\\\"Create a new task with given label, points and parent.\\\"\\\"\\\"\\n        with world.db:\\n            return world.db.execute(\\n                'INSERT INTO tasks (label, points, parent) VALUES (?, ?, ?)',\\n                (label, points, parent)\\n            ).lastrowid\\n\\n    def update_task_label(self, task_id, label):\\n        \\\"\\\"\\\"Update the label of an existing task.\\\"\\\"\\\"\\n        with world.db:\\n            return world.db.execute(\\n                'UPDATE tasks SET label = ? WHERE id = ?',\\n                (label, task_id)\\n            )\\n\\n    def update_task_points(self, task_id, points):\\n        \\\"\\\"\\\"Update the points of an existing task.\\\"\\\"\\\"\\n        with world.db:\\n            return world.db.execute(\\n                'UPDATE tasks SET points = ? WHERE id = ?',\\n                (points, task_id)\\n            )\\n\\n    def get_root_tasks(self):\\n        \\\"\\\"\\\"Get all non-archived tasks that have no parent.\\\"\\\"\\\"\\n        query = '''\\n            SELECT * FROM tasks \\n            WHERE parent IS NULL AND archived_at IS NULL and done_at is null\\n            ORDER BY pos ASC\\n        '''\\n        return [dict(row) for row in world.db.execute(query).fetchall()]\\n\\n    def get_child_tasks(self, task_id):\\n        \\\"\\\"\\\"Get all non-archived child tasks for a given task ID.\\\"\\\"\\\"\\n        return [\\n            dict(row) for row in \\n            world.db.execute(\\n                'SELECT * FROM tasks WHERE parent = ? AND archived_at IS NULL and done_at is null',\\n                (task_id,)\\n            ).fetchall()\\n        ]\\n\\n    def get_child_tasks_count(self, task_id):\\n        \\\"\\\"\\\"Get the count of non-archived child tasks for a given task ID.\\\"\\\"\\\"\\n        return world.db.execute(\\n            'SELECT COUNT(*) as count FROM tasks WHERE parent = ? AND archived_at IS NULL and done_at is null',\\n            (task_id,)\\n        ).fetchone()[0]\\n\\n    def get_total_points(self):\\n        \\\"\\\"\\\"Get the sum of points for all completed, non-archived tasks.\\\"\\\"\\\"\\n        result = world.db.execute(\\n            '''\\n            SELECT SUM(points) as total_points\\n            FROM tasks\\n            WHERE done_at IS NOT NULL AND archived_at IS NULL\\n            '''\\n        ).fetchone()\\n        return result['total_points'] or 0\\n\\n    def set_task_done(self, task_id, value):\\n        \\\"\\\"\\\"Set task as done or not done by updating done_at timestamp.\\\"\\\"\\\"\\n        with world.db:\\n            done_at = int(time.time()) if value else None\\n            return world.db.execute(\\n                'UPDATE tasks SET done_at = ? WHERE id = ?',\\n                (done_at, task_id)\\n            )\\n\\n    def set_task_archived(self, task_id, value):\\n        \\\"\\\"\\\"Set task as archived or not archived by updating archived_at timestamp.\\\"\\\"\\\"\\n        with world.db:\\n            archived_at = int(time.time()) if value else None\\n            return world.db.execute(\\n                'UPDATE tasks SET archived_at = ? WHERE id = ?',\\n                (archived_at, task_id)\\n            )\\n\\n    def get_total_points_since(self, since):\\n        \\\"\\\"\\\"Sum points of done, non-archived tasks since a given time.\\\"\\\"\\\"\\n        result = world.db.execute(\\n            '''\\n            SELECT SUM(points) as total_points\\n            FROM tasks\\n            WHERE done_at IS NOT NULL AND done_at >= ? AND archived_at IS NULL\\n            ''',\\n            (since,)\\n        ).fetchone()\\n        return result['total_points'] or 0\\n\\n    def get_total_points_last_24h(self):\\n        \\\"\\\"\\\"Get the sum of points for tasks completed in the last 24 hours.\\\"\\\"\\\"\\n        since = int(time.time()) - 86400  # 24 * 60 * 60\\n        return self.get_total_points_since(since)\\n\\n    def get_total_points_last_7d(self):\\n        \\\"\\\"\\\"Get the sum of points for tasks completed in the last 7 days.\\\"\\\"\\\"\\n        since = int(time.time()) - 7 * 86400\\n        return self.get_total_points_since(since)\\n\\n    def drop(self):\\n        pass\\n\", \"name\": \"Tasks\"}", "created_at": null, "updated_at": 1756754129.7218058}