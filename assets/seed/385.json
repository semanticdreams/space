{"id": "385", "type": "class", "data": "{\"code_str\": \"class Vim:\\n    def __init__(self):\\n        self.state = world.states.create_state(name='vim', on_enter=self.on_enter, on_leave=self.on_leave)\\n        self.entered = z.Signal()\\n        self.left = z.Signal()\\n\\n        self._connected_gamepads = set()\\n\\n        self.modes = {}\\n        self.current_mode_changed = z.Signal()\\n\\n        self._ignore_next_char = False\\n\\n        world.vim = self\\n        self.default_setup()\\n\\n    def default_setup(self):\\n        self.add_mode(z.NormalVimMode())\\n        self.add_mode(z.InsertVimMode())\\n        self.add_mode(z.LeaderVimMode())\\n        self.add_mode(z.AppsVimMode())\\n        self.add_mode(z.QuitVimMode())\\n        self.add_mode(z.StateVimMode())\\n        self.add_mode(z.EntitiesVimMode())\\n        self.current_mode = self.modes['normal']\\n\\n    def add_mode(self, mode):\\n        self.modes[mode.name] = mode\\n\\n    def remove_mode(self, name):\\n        del self.modes[name]\\n\\n    def set_current_mode(self, name):\\n        mode = self.modes[name]\\n        if mode != self.current_mode:\\n            if self.current_mode is not None:\\n                self.current_mode.on_leave()\\n            self.current_mode = mode\\n            self.current_mode.on_enter()\\n            self.current_mode_changed.emit()\\n\\n    def on_enter(self):\\n        world.window.keyboard.connect(self.on_keyboard)\\n        world.window.character.connect(self.on_character)\\n        world.apps['CombinedMouseControl'].on_enter()\\n        world.gamepads.gamepad_added.connect(self.gamepad_added)\\n        world.gamepads.gamepad_removed.connect(self.gamepad_removed)\\n        for gamepad in world.gamepads.gamepads:\\n            self.gamepad_added(gamepad)\\n        self.entered.emit()\\n\\n    def on_leave(self):\\n        world.window.keyboard.disconnect(self.on_keyboard)\\n        world.window.character.disconnect(self.on_character)\\n        world.apps['CombinedMouseControl'].on_leave()\\n        world.gamepads.gamepad_added.disconnect(self.gamepad_added)\\n        world.gamepads.gamepad_removed.disconnect(self.gamepad_removed)\\n        for gamepad in list(self._connected_gamepads):\\n            self.gamepad_removed(gamepad)\\n        self.left.emit()\\n\\n    def gamepad_added(self, gamepad):\\n        if gamepad not in self._connected_gamepads:\\n            gamepad.button_down.connect(self.controller_button_down)\\n            gamepad.button_up.connect(self.controller_button_up)\\n            gamepad.motion.connect(self.controller_motion)\\n            self._connected_gamepads.add(gamepad)\\n\\n    def gamepad_removed(self, gamepad):\\n        if gamepad in self._connected_gamepads:\\n            gamepad.button_down.disconnect(self.controller_button_down)\\n            gamepad.button_up.disconnect(self.controller_button_up)\\n            gamepad.motion.disconnect(self.controller_motion)\\n            self._connected_gamepads.discard(gamepad)\\n\\n    def on_keyboard(self, key, scancode, action, mods):\\n        self.current_mode.on_keyboard(key, scancode, action, mods)\\n\\n    def on_character(self, key):\\n        if self._ignore_next_char:\\n            self._ignore_next_char = False\\n        else:\\n            self.current_mode.on_character(key)\\n\\n    def controller_button_down(self, button, state, timestamp):\\n        self.current_mode.on_controller_button_down(button)\\n\\n    def controller_button_up(self, button, state, timestamp):\\n        self.current_mode.on_controller_button_up(button)\\n\\n    def controller_motion(self, axis, value, timestamp):\\n        self.current_mode.on_controller_motion(axis, value)\\n\\n    def drop(self):\\n        world.states.drop_state(self.state)\\n\", \"name\": \"Vim\"}", "created_at": null, "updated_at": 1756754129.7247598}