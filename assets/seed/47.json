{"id": "47", "type": "class", "data": "{\"code_str\": \"class FunkyTriangle:\\n    vertices = np.array([\\n        0, 0, 0,\\n        1, 0, 0, 1,\\n        0, 1, 0,\\n        0, 1, 0, 1,\\n        1, 1, 0,\\n        0, 0, 1, 1,\\n    ], np.float32)\\n\\n    def __init__(self):\\n        self.name = z.ReactiveValue('funky-triangle')\\n        self.focus = world.focus.add_child(self)\\n        self.triangle_vector = world.render_configurations['triangles'].vector\\n        self.handle = self.triangle_vector.allocate(self.vertices.size)\\n\\n        self.layout = z.Layout(measurer=self.measurer, layouter=self.layouter, name='funky-triangle',\\n                                       transformer=self.update_positions)\\n\\n        #self.layout.set_constraints(z.BoxConstraints(min=self.size, max=self.size))\\n\\n        #self.spatiolator = z.Spatiolator(self.layout, self)\\n\\n        self.update_color()\\n\\n    def drop(self):\\n        self.layout.drop()\\n        self.triangle_vector.delete(self.handle)\\n        self.focus.drop()\\n\\n    def update_positions(self):\\n        v = self.triangle_vector.view(self.handle)\\n        rotation_matrix = transformations.quaternion_matrix(\\n            self.layout.rotation)[:-1, :-1]\\n        size = np.array((self.size[0], self.size[1], 0))\\n        for i in range(0, v.size, 7):\\n            b = self.vertices[i:i+3]\\n            v[i:i+3] = np.matmul(rotation_matrix, (size * b)) + self.layout.position\\n\\n    def update_color(self):\\n        v = self.triangle_vector.view(self.handle)\\n        for i in range(0, v.size, 7):\\n            v[i+3:i+7] = z.random_color()\\n\\n    def measurer(self):\\n        return np.array((30, 30, 0))\\n\\n    def layouter(self, constraints):\\n        #self.size = constraints.min\\n        self.size = np.array((constraints.max[0], constraints.max[1], 0))\\n        return self.size\\n        #return np.pad(self.size, (0, 1))\\n\\n    def aabb(self):\\n        v = self.triangle_vector.view(self.handle)\\n        vertices = [v[0:3], v[7:10], v[14:17]]\\n        return np.array((np.amin(vertices, axis=0), np.amax(vertices, axis=0)))\\n\\n    def intersect(self, ray):\\n        v = self.triangle_vector.view(self.handle)\\n        t1 = np.array((v[0:3], v[7:10], v[14:17]))\\n        return z.ray_triangle_intersect(ray, t1)\", \"name\": \"FunkyTriangle\"}", "created_at": null, "updated_at": 1754736945.4582133}