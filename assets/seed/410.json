{"id": "410", "type": "class", "data": "{\"code_str\": \"class ListEntityView:\\n    def __init__(self, entity, focus_parent=None):\\n        self.focus = (focus_parent or world.focus).add_child(self)\\n        self.entity = entity\\n        assert isinstance(self.entity.id, str)\\n        self.actions_panel = z.ActionsPanel([\\n            ('copy entity', self.copy_triggered),\\n            ('delete', self.entity.delete),\\n            ('paste entity as list item', self.paste_triggered),\\n        ], focus_parent=self.focus)\\n\\n        self.objs = []\\n        self.items_column = z.Flex([], axis='y', xalign='largest')\\n\\n        self.column = z.Flex([\\n            z.FlexChild(self.actions_panel.layout),\\n            z.FlexChild(self.items_column.layout, flex=1)\\n        ], axis='y', xalign='largest')\\n        self.layout = self.column.layout\\n\\n        self.update_items()\\n\\n    def __str__(self):\\n        return str(self.entity)\\n\\n    def copy_triggered(self):\\n        Y(self.entity, 'entity')\\n\\n    def drop_objs(self):\\n        self.items_column.clear_children()\\n        for obj in self.objs:\\n            obj.drop()\\n        self.objs.clear()\\n\\n    def remove_item(self, entity):\\n        self.entity.remove_list_item(entity.id)\\n        self.update_items()\\n\\n    def move_item_up(self, entity):\\n        items = self.entity.list_items\\n        item = one([x for x in items if x['entity_id'] == entity.id])\\n        lower_items = [x for x in items\\n                        if x['pos'] < item['pos']]\\n        if lower_items:\\n            max_lower_item = max(lower_items, key=lambda x: x['pos'])\\n            a, b = item['pos'], max_lower_item['pos']\\n            self.entity.set_list_item_pos(max_lower_item['entity_id'], a)\\n            self.entity.set_list_item_pos(item['entity_id'], b)\\n            self.update_items()\\n\\n    def move_item_down(self, entity):\\n        items = self.entity.list_items\\n        item = one([x for x in items if x['entity_id'] == entity.id])\\n        higher_items = [x for x in items\\n                        if x['pos'] > item['pos']]\\n        if higher_items:\\n            min_higher_item = min(higher_items, key=lambda x: x['pos'])\\n            a, b = item['pos'], min_higher_item['pos']\\n            self.entity.set_list_item_pos(min_higher_item['entity_id'], a)\\n            self.entity.set_list_item_pos(item['entity_id'], b)\\n            self.update_items()\\n\\n    def update_items(self):\\n        self.drop_objs()\\n        for item in self.entity.list_items:\\n            try:\\n                entity = world.apps['Entities'].get_entity(item)\\n            except z.EntityNotFoundError:\\n                self.entity.remove_list_item(item)\\n                self.entity.save()\\n                continue\\n            obj = z.ListEntityViewChild(self, entity, focus_parent=self.focus)\\n            self.objs.append(obj)\\n        self.items_column.set_children([z.FlexChild(x.layout) for x in self.objs])\\n\\n    def paste_triggered(self):\\n        assert Y.register_type == 'entity', Y.register_type\\n        entity = Y.value\\n        self.entity.add_list_item(entity)\\n        self.update_items()\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.actions_panel.drop()\\n        self.items_column.drop()\\n        self.drop_objs()\\n        self.focus.drop()\\n\", \"name\": \"ListEntityView\"}", "created_at": null, "updated_at": 1754736945.4627528}