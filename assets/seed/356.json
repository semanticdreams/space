{"id": "356", "type": "class", "data": "{\"code_str\": \"class CameraVimMode(z.VimMode):\\n    def __init__(self):\\n        super().__init__('camera')\\n        self.add_action_group(z.VimActionGroup('camera', [\\n            z.VimAction('leave', self.set_current_vim_mode_normal, sdl2.SDLK_ESCAPE),\\n            z.VimAction('enable-fpc', self.enable_fpc, sdl2.SDLK_f),\\n            z.VimAction('approach1', self.approach1, sdl2.SDLK_1),\\n            z.VimAction('approach2', self.approach2, sdl2.SDLK_2),\\n            z.VimAction('approach3', self.approach3, sdl2.SDLK_3),\\n            z.VimAction('reset', self.reset, sdl2.SDLK_0),\\n            z.VimAction('snap-to-grid', self.snap_to_grid, sdl2.SDLK_9),\\n            z.VimAction('box-selector', self.box_selector, sdl2.SDLK_b),\\n        ]))\\n\\n    def set_current_vim_mode_normal(self):\\n        world.vim.set_current_mode('normal')\\n\\n    def enable_fpc(self):\\n        world.states.transit(state_name='fpc')\\n        world.vim.set_current_mode('normal')\\n\\n    def approach(self, closeness):\\n        node = world.focus.current\\n        if not node or not node.obj:\\n            return\\n        world.camera['default'].approach(node.obj.layout, closeness)\\n        world.vim.set_current_mode('normal')\\n\\n    def approach1(self):\\n        self.approach(100)\\n\\n    def approach2(self):\\n        self.approach(200)\\n\\n    def approach3(self):\\n        self.approach(300)\\n\\n    def reset(self):\\n        world.camera.camera.set_position([0, 0, 0])\\n        world.camera.camera.set_rotation([1, 0, 0, 0])\\n        world.vim.set_current_mode('normal')\\n\\n    def snap_to_grid(self):\\n        # snap position\\n        grid_unit_size = 1\\n        self.world.camera.camera.set_position(\\n            np.round(self.world.camera.camera.position / grid_unit_size) * grid_unit_size)\\n        # snap rotation\\n        grid_unit_angle = 90\\n        r = self.world.camera.camera.rotation\\n        theta = np.arccos(r[0]) * 2\\n        sin_theta_over_2 = np.sqrt(1 - r[0]**2)\\n        axis = r[1:] / (sin_theta_over_2 + 1e-10)\\n        theta_deg = np.degrees(theta)\\n        snapped_theta_deg = round(theta_deg / grid_unit_angle) * grid_unit_angle\\n        snapped_theta = np.radians(snapped_theta_deg)\\n        new_w = np.cos(snapped_theta / 2)\\n        new_xyz = axis * np.sin(snapped_theta / 2)\\n        world.camera.camera.set_rotation([new_w, new_xyz[0], new_xyz[1], new_xyz[2]])\\n        world.vim.set_current_mode('normal')\\n\\n    def box_selector(self):\\n        world.states.transit(state_name='camera-box-selector')\\n        world.vim.set_current_mode('normal')\", \"name\": \"CameraVimMode\"}", "created_at": null, "updated_at": 1754736945.475714}