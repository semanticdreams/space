{"id": "308", "type": "class", "data": "{\"code_str\": \"import traceback\\nimport code\\nimport os, json\\nimport sys\\nimport io\\nimport textwrap\\nimport numpy as np\\nimport sdl2\\n\\n\\nclass Console:\\n    history_path = os.path.join(world.datadir, 'console_history')\\n\\n    def __init__(self):\\n        self.prompt = '>>>'\\n        self.cmdlines = [self.prompt + ' ']\\n        self.cmds = json.load(open(self.history_path))\\n        self.cmd_index = len(self.cmds) - 1\\n        self.runner = code.InteractiveConsole(locals=dict(world=world))\\n\\n        self.changed = z.Signal()\\n\\n    def write(self, text):\\n        self.cmdlines[-1] += str(text)\\n        self.changed.emit()\\n\\n    def writeline(self, text):\\n        text = '\\\\n'.join(reversed(text.split('\\\\n')))\\n        self.cmdlines.append(str(text))\\n        self.changed.emit()\\n\\n    def inject(self, text):\\n        out = io.StringIO()\\n        err = io.StringIO()\\n\\n        with z.Redirected(out=out, err=err):\\n            out.flush()\\n            err.flush()\\n\\n            more = self.runner.runcode(text)\\n\\n            output = out.getvalue()\\n            error = err.getvalue()\\n\\n        self.writeline(output)\\n        self.writeline(error)\\n\\n        self.prompt = '...' if more else '>>>'\\n\\n    def ret(self):\\n        text = self.cmdlines[-1].strip()[4:]\\n        if text:\\n            self.cmds.append(text)\\n            self.cmd_index = len(self.cmds)\\n            self.save_history()\\n            self.eval(text)\\n        self.writeline(self.prompt + ' ')\\n\\n    def backspace(self):\\n        self.cmdlines[-1] = self.cmdlines[-1][:max(4, len(self.cmdlines[-1])-1)]\\n        self.changed.emit()\\n\\n    def eval(self, cmd):\\n        out = io.StringIO()\\n        err = io.StringIO()\\n\\n        with z.Redirected(out=out, err=err):\\n            out.flush()\\n            err.flush()\\n\\n            more = self.runner.push(cmd)\\n\\n            output = out.getvalue()\\n            error = err.getvalue()\\n\\n        self.writeline(output)\\n        self.writeline(error)\\n\\n        self.prompt = '...' if more else '>>>'\\n\\n    def browse_history(self, direction):\\n        if direction == 'up':\\n            if self.cmd_index > 0:\\n                self.cmd_index -= 1\\n        elif direction == 'down':\\n            if self.cmd_index < len(self.cmds) - 1:\\n                self.cmd_index += 1\\n            else:\\n                self.cmd_index = len(self.cmds)\\n                self.cmdlines[-1] = self.prompt + ' '\\n                self.changed.emit()\\n                return\\n        if 0 <= self.cmd_index < len(self.cmds):\\n            self.cmdlines[-1] = self.prompt + ' ' + self.cmds[self.cmd_index]\\n        else:\\n            self.cmdlines[-1] = self.prompt + ' '\\n        self.changed.emit()\\n\\n    def save_history(self):\\n        with open(self.history_path ,'w') as f:\\n            json.dump(self.cmds, f)\", \"name\": \"Console\"}", "created_at": null, "updated_at": 1751906432.7453039}