{"id": "183", "type": "class", "data": "{\"code_str\": \"import os\\nimport anthropic\\nimport pypika\\n\\nclient = anthropic.AsyncAnthropic(api_key=os.environ['ANTHROPIC_API_KEY'])\\nmodel = 'claude-3-7-sonnet-latest'\\n\\nclass Claude:\\n    def get_conversations(self):\\n        return list(map(z.ClaudeConversation, map(dict, world.db.execute(\\n            'select * from claude_conversations'\\n            ' where archived_at is null'\\n            ' order by created_at desc'\\n        ).fetchall())))\\n\\n    def create_conversation(self):\\n        with world.db:\\n            cur = world.db.execute('insert into claude_conversations (created_at) values (?)', (time.time(),))\\n        return self.get_conversation(cur.lastrowid)\\n\\n    def get_conversation(self, id=None, name=None):\\n        t = pypika.Table('claude_conversations')\\n        q = pypika.Query.from_(t).select('*')\\n        if id is not None:\\n            q = q.where(t.id == id)\\n        if name is not None:\\n            q = q.where(t.name == name)\\n        q = q.limit(1)\\n        return z.ClaudeConversation(dict(one(world.db.execute(str(q)).fetchall())))\\n\\n    async def send(self, messages, system=None, max_tokens=None, temperature=None, tools=None):\\n        args = {}\\n        if system:\\n            args['system'] = system\\n        if max_tokens:\\n            args['max_tokens'] = max_tokens\\n        if temperature is not None:\\n            args['temperature'] = temperature\\n        if tools is not None:\\n            args['tools'] = tools\\n\\n        for message in messages:\\n            message['role'] = message.get('role', 'user')\\n\\n        print(tools)\\n        response = await client.messages.create(model=model, messages=messages, **args)\\n        return response\\n\\n    async def count_tokens(self, messages, system=None, max_tokens=None, temperature=None, tools=None):\\n        args = {}\\n        if system:\\n            args['system'] = system\\n        if max_tokens:\\n            args['max_tokens'] = max_tokens\\n        if temperature is not None:\\n            args['temperature'] = temperature\\n        if tools is not None:\\n            args['tools'] = tools\\n\\n        for message in messages:\\n            message['role'] = message.get('role', 'user')\\n\\n        response = await client.messages.count_tokens(model=model, messages=messages, **args)\\n        return response\\n\\n    def drop(self):\\n        pass\", \"name\": \"Claude\"}", "created_at": null, "updated_at": 1751906432.739955}