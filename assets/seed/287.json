{"id": "287", "type": "class", "data": "{\"code_str\": \"import subprocess\\nimport re\\n\\n\\nclass BluetoothAudioManager:\\n    def __init__(self):\\n        self.card = self.get_bluetooth_audio_card()\\n        self.headsets = self.get_connected_bluetooth_headsets()\\n        self.a2dp_profile = None\\n        self.hsp_profile = None\\n        if self.card:\\n            self.detect_available_profiles()\\n\\n    def get_connected_bluetooth_headsets(self):\\n        result = subprocess.run([\\\"bluetoothctl\\\", \\\"devices\\\"], capture_output=True, text=True)\\n        devices = []\\n        for line in result.stdout.strip().split(\\\"\\\\n\\\"):\\n            match = re.search(r\\\"Device ([\\\\w:]+) (.+)\\\", line)\\n            if match:\\n                devices.append({\\n                    \\\"mac\\\": match.group(1),\\n                    \\\"name\\\": match.group(2)\\n                })\\n        return devices\\n\\n    def get_bluetooth_audio_card(self):\\n        result = subprocess.run([\\\"pactl\\\", \\\"list\\\", \\\"cards\\\", \\\"short\\\"], capture_output=True, text=True)\\n        for line in result.stdout.strip().split(\\\"\\\\n\\\"):\\n            parts = line.split(\\\"\\\\t\\\")\\n            if \\\"bluez\\\" in parts[1]:\\n                return parts[1]\\n        return None\\n\\n    def detect_available_profiles(self):\\n        result = subprocess.run([\\\"pactl\\\", \\\"list\\\", \\\"cards\\\"], capture_output=True, text=True)\\n        card_blocks = result.stdout.split(\\\"Card #\\\")\\n        for block in card_blocks:\\n            if self.card and self.card in block:\\n                # Extract profiles under the \\\"Profiles:\\\" section\\n                profiles_section = re.search(r\\\"Profiles:(.*?)(Active Profile|Properties:|$)\\\", block, re.DOTALL)\\n                if profiles_section:\\n                    profiles_text = profiles_section.group(1)\\n                    profiles = re.findall(r\\\"^\\\\s+([^\\\\s:]+):\\\", profiles_text, re.MULTILINE)\\n                    for profile in profiles:\\n                        if \\\"a2dp\\\" in profile:\\n                            self.a2dp_profile = profile\\n                        elif \\\"headset\\\" in profile or \\\"handsfree\\\" in profile or \\\"hsp\\\" in profile or \\\"hfp\\\" in profile:\\n                            self.hsp_profile = profile\\n                break\\n        print(f\\\"Detected A2DP Profile: {self.a2dp_profile}\\\")\\n        print(f\\\"Detected HSP/HFP Profile: {self.hsp_profile}\\\")\\n\\n    def get_current_audio_profile(self):\\n        if not self.card:\\n            return None\\n        result = subprocess.run([\\\"pactl\\\", \\\"list\\\", \\\"cards\\\"], capture_output=True, text=True)\\n        card_blocks = result.stdout.split(\\\"Card #\\\")\\n        for block in card_blocks:\\n            if self.card in block:\\n                profile_match = re.search(r\\\"Active Profile: ([^\\\\n]+)\\\", block)\\n                if profile_match:\\n                    return profile_match.group(1).strip()\\n        return None\\n\\n    def switch_audio_profile(self, profile_name):\\n        if not self.card or not profile_name:\\n            print(\\\"No Bluetooth audio card or profile found.\\\")\\n            return\\n        subprocess.run([\\\"pactl\\\", \\\"set-card-profile\\\", self.card, profile_name])\\n        print(f\\\"Switched {self.card} to {profile_name}\\\")\\n\\n    def switch_to_headset_profile(self):\\n        self.switch_audio_profile(self.hsp_profile)\\n\\n    def switch_to_quality_profile(self):\\n        self.switch_audio_profile(self.a2dp_profile)\\n\\n    def toggle_profile(self):\\n        current_profile = self.get_current_audio_profile()\\n        if not current_profile:\\n            print(\\\"No active profile detected.\\\")\\n            return\\n        if current_profile == self.a2dp_profile:\\n            self.switch_to_headset_profile()\\n        elif current_profile == self.hsp_profile:\\n            self.switch_to_quality_profile()\\n        else:\\n            print(\\\"Unknown profile, defaulting to A2DP.\\\")\\n\\n    def get_sink(self):\\n        if not self.card:\\n            return None\\n        # Extract the MAC portion from the card name\\n        mac_part = self.card.replace(\\\"bluez_card.\\\", \\\"\\\")  # e.g., AC_3E_B1_86_B4_CB\\n        result = subprocess.run([\\\"pactl\\\", \\\"list\\\", \\\"sinks\\\"], capture_output=True, text=True)\\n        sinks = result.stdout.split(\\\"Sink #\\\")\\n        for block in sinks:\\n            if f\\\"bluez_sink.{mac_part}\\\" in block:\\n                match = re.search(r\\\"Name: ([^\\\\s]+)\\\", block)\\n                if match:\\n                    sink_name = match.group(1)\\n                    print(f\\\"Detected sink for card {self.card}: {sink_name}\\\")\\n                    return sink_name\\n        return None\\n\\n    def force_transport_reconnect(self):\\n        sink = self.get_sink()\\n        subprocess.run([\\\"pactl\\\", \\\"suspend-sink\\\", sink, \\\"1\\\"])\\n        subprocess.run([\\\"pactl\\\", \\\"suspend-sink\\\", sink, \\\"0\\\"])\\n\\n    def status(self):\\n        print(f\\\"Detected headset(s): {[d['name'] for d in self.headsets] if self.headsets else 'None'}\\\")\\n        print(f\\\"Bluetooth audio card: {self.card if self.card else 'None'}\\\")\\n        print(f\\\"Current profile: {self.get_current_audio_profile() if self.card else 'N/A'}\\\")\\n\\n    def drop(self):\\n        pass\\n\\n\\nif __name__ == \\\"__main__\\\":\\n    manager = BluetoothAudioManager()\\n    manager.status()\\n    manager.toggle_profile()\\n    manager.force_transport_reconnect()\\n\", \"name\": \"BluetoothAudioManager\"}", "created_at": null, "updated_at": 1756754129.7298002}