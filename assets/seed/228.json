{"id": "228", "type": "class", "data": "{\"code_str\": \"import io, traceback\\nclass PyObjView:\\n    def __init__(self, obj, reloadable=False, focus_parent=world.focus,\\n                 show_console=True):\\n        self.obj = obj\\n        self.reloadable = reloadable\\n        self.show_underscored = False\\n        self.show_console = show_console\\n        self.name = z.ReactiveValue(self.make_name())\\n        self.focus = focus_parent.add_child(obj=self)\\n\\n        self.obj_type = type(obj)\\n\\n        self.type_button = z.Button(str(self.obj_type),\\n                                            wrap=None, focus_parent=self.focus)\\n        self.type_button.clicked.connect(lambda f, i, d: world.floaties.add(PyObjView(self.obj_type)))\\n\\n        self.class_button = z.Button('class',\\n                                            focus_parent=self.focus)\\n        def get_class_clicked(f, i, d):\\n            ClassView = world.classes['ClassView']\\n            class_view = ClassView(world.classes.get_class_code(name=self.obj.__class__.__name__), self.obj)\\n            #if self.reloadable:\\n            #    def on_class_changed(_):\\n            #        world.floaties.reload(self.obj)\\n            #    class_view.changed.connect(on_class_changed)\\n            world.floaties.add(class_view)\\n        self.class_button.clicked.connect(get_class_clicked)\\n\\n        self.inspect_panel = z.Flex([\\n            z.FlexChild(self.type_button.layout),\\n            z.FlexChild(self.class_button.layout),\\n        ], yalign='largest')\\n\\n        self.actions_panel = world.classes.get_class(name='ActionsPanel')(actions=[\\n            ('reload', self.update_items),\\n            ('__', self.toggle_underscore_attrs_triggered),\\n            ('call', self.call_triggered),\\n            ('call with args', self.call_with_args_triggered),\\n            ('with view', self.custom_view_class_triggered),\\n            ('with default view', self.with_default_view_triggered),\\n        ],\\n            focus_parent=self.focus\\n        )\\n\\n        self.search_view = z.SearchView([], builder=z.PyObjAttr, show_head=False, focus_parent=self.focus)\\n\\n        if self.show_console:\\n            self.code_input = z.Input(focus_parent=self.focus, multiline=True, max_lines=5,\\n                min_lines=5)\\n            self.code_input.submitted.connect(self.code_submitted)\\n            self.code_output = z.ContextButton(focus_parent=self.focus)\\n\\n        them = [\\n            z.FlexChild(self.inspect_panel.layout),\\n            z.FlexChild(self.actions_panel.layout),\\n            z.FlexChild(self.search_view.layout),\\n        ]\\n        if self.show_console:\\n            them.extend([\\n                    z.FlexChild(self.code_input.layout),\\n                    z.FlexChild(self.code_output.layout)\\n            ])\\n        self.column = z.Flex(them, axis='y', xalign='largest')\\n\\n        self.layout = self.column.layout\\n\\n        self.update_items()\\n\\n    def code_submitted(self):\\n        code_str = self.code_input.text\\n        out, err = io.StringIO(), io.StringIO()\\n        error = None\\n        with z.Redirected(out=out, err=err):\\n            out.flush; err.flush()\\n            try:\\n                exec(code_str, {'self': self.obj})\\n            except:\\n                error = traceback.format_exc()\\n            output = out.getvalue()\\n        self.code_output.set_label((error or output).strip())\\n\\n    def make_name(self):\\n        return f'pyobj: {self.obj}'\\n\\n    def update_items(self):\\n        objs = [(self.obj, x) for x in dir(self.obj)\\n                if not x.startswith('__') or self.show_underscored]\\n        self.search_view.set_items(objs)\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.inspect_panel.drop()\\n        self.type_button.drop()\\n        self.class_button.drop()\\n        self.search_view.drop()\\n        if self.show_console:\\n            self.code_input.drop()\\n            self.code_output.drop()\\n        self.actions_panel.drop()\\n        self.focus.drop()\\n\\n    def custom_view_class_triggered(self):\\n        world.floaties.add(z.OpenWithClassView(self.obj))\\n\\n    def with_default_view_triggered(self):\\n        view_class_names = world.apps['DefaultViews'].get_views(type(self.obj).__name__)\\n        cls = world.classes.get_class(name=view_class_names[0])\\n        world.floaties.add(cls(self.obj))\\n\\n    def toggle_underscore_attrs_triggered(self):\\n        self.show_underscored = not self.show_underscored\\n        self.update_items()\\n\\n    def call_triggered(self):\\n        try:\\n            result = self.obj()\\n        except Exception as e:\\n            world.floaties.add(z.PyErrorView(e))\\n        else:\\n            world.floaties.add(PyObjView(result))\\n\\n    def call_with_args_triggered(self):\\n        world.floaties.add(PyCallView(self.obj))\\n\", \"name\": \"PyObjView\"}", "created_at": null, "updated_at": 1751906432.7396364}