{"id": "409", "type": "class", "data": "{\"code_str\": \"import uuid\\nimport json\\nimport pypika\\n\\n\\nclass Entities:\\n    type_class_map = {\\n        'int': z.IntEntity,\\n        'list': z.ListEntity,\\n        'float': z.FloatEntity,\\n        'string': z.StringEntity,\\n        'bool': z.BoolEntity,\\n        'dict': z.DictEntity,\\n        'json': z.JsonEntity,\\n        'tag': z.TagEntity,\\n        'graph': z.GraphEntity,\\n        'code': z.CodeEntity,\\n        'class': z.ClassEntity,\\n        'task': z.TaskEntity,\\n        'workspace': z.Workspace,\\n        'workspaces': z.Workspaces,\\n        'dynamic-graph': z.DynamicGraphEntity,\\n        'shader': z.ShaderEntity,\\n        'fs-folder': z.FSFolderEntity,\\n        'llm-message': z.LLMMessageEntity,\\n        'llm-conversation': z.LLMConversationEntity,\\n    }\\n\\n    morphs = {\\n        'string': [\\n            ('code', z.String2CodeEntityMorph),\\n            ('dict', z.String2DictEntityMorph),\\n            ('json', z.String2JsonEntityMorph),\\n            ('task', z.String2TaskEntityMorph),\\n            ('llm-message', z.String2LLMMessageEntityMorph),\\n            ('llm-conversation', z.String2LLMConversationEntityMorph),\\n        ],\\n        'code': [\\n            ('class', z.Code2ClassEntityMorph)\\n        ],\\n        'dict': [\\n            ('json', z.Dict2JsonEntityMorph),\\n        ],\\n    }\\n\\n    def get_entity_class(self, type):\\n        return self.type_class_map[type]\\n\\n    def get_entity(self, entity_id):\\n        assert isinstance(entity_id, str)\\n        entities = world.db.execute('select * from entities where id = ?', (str(entity_id),)).fetchall()\\n        if not entities:\\n            raise z.EntityNotFoundError(entity_id)\\n        data = dict(entities[0])\\n        cls = self.get_entity_class(data['type'])\\n        return cls.load(str(entity_id), json.loads(data['data']))\\n\\n    def get_entities(self, type=None):\\n        t = pypika.Table('entities')\\n        q = pypika.Query.from_(t).select('*')\\n        if type is not None:\\n            q = q.where(t.type == type)\\n        entities = world.db.execute(str(q)).fetchall()\\n        return [self.get_entity_class(x['type']).load(\\n            str(x['id']),\\n            json.loads(x['data']))\\n            for x in entities]\\n\\n    #def get_entities(self):\\n    #    entities = world.db.execute('select * from entities').fetchall()\\n    #    return [self.get_entity_class(x['type']).load(x['item_id']) for x in entities]\\n\\n    def delete_entity(self, entity_id):\\n        with world.db:\\n            world.db.execute('delete from entities where id = ?', (str(entity_id),))\\n\\n    #def find_entity(self, type, item_id):\\n    #    return dict(world.db.execute('select * from entities where type = ? and item_id = ?', (type, item_id)).fetchall()[0])\\n\\n    def create_entity(self, type, data=None, id=None):\\n        id = str(uuid.uuid4()) if id is None else id\\n        now = time.time()\\n        with world.db:\\n            world.db.execute(\\n                'insert into entities (id, type, data, created_at, updated_at)'\\n                ' values (?, ?, ?, ?, ?)', (id, type, data, now, now))\\n        return id\\n\\n    def update_id(self, old_id, new_id):\\n        assert isinstance(new_id, str)\\n        with world.db:\\n            world.db.execute(\\n                'update entities set id = ?, updated_at = ? where id = ?',\\n                (new_id, time.time(), old_id))\\n\\n    #def ensure_entity(self, type, item_id):\\n    #    result = world.db.execute('select * from entities where type = ? and item_id = ?', (type, item_id)).fetchall()\\n    #    if result:\\n    #        entity = dict(result[0])\\n    #    else:\\n    #        entity_id = self.create_entity(type, item_id)\\n    #        entity = dict(id=entity_id,\\n    #                       type=type, item_id=item_id)\\n    #    return entity\\n\\n    #def discard_entity(self, type, item_id):\\n    #    with world.db:\\n    #        world.db.execute('delete from entities where type = ? and item_id = ?', (type, item_id))\\n\\n    def drop(self):\\n        pass\\n\", \"name\": \"Entities\"}", "created_at": null, "updated_at": 1754239007.500817}