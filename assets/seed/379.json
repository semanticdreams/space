{"id": "379", "type": "class", "data": "{\"code_str\": \"class NormalVimMode(z.VimMode):\\n    def __init__(self):\\n        super().__init__('normal')\\n\\n        self.input = None\\n\\n        default_action_group = z.VimActionGroup('default', [\\n            z.VimAction('leader', self.set_current_mode_leader, sdl2.SDLK_SPACE),\\n            #z.VimAction('focus-next', self.focus_next, sdl2.SDLK_TAB),\\n            z.VimAction('dump-focus-tree', self.dump_focus_tree, sdl2.SDLK_F3),\\n        ])\\n        self.add_action_group(default_action_group)\\n\\n        self.query = ''\\n        self.reset()\\n\\n    def set_input(self, input):\\n        self.input = input\\n\\n    def set_current_mode_leader(self):\\n        world.vim.set_current_mode('leader')\\n\\n    def focus_next(self):\\n        world.focus.focus_next()\\n\\n    def dump_focus_tree(self):\\n        world.focus.dump()\\n\\n    def on_enter(self):\\n        pass\\n\\n    def on_leave(self):\\n        pass\\n\\n    def reset(self):\\n        self.operator = ''\\n        self.count = ''\\n        self.prefix = ''\\n\\n    def on_controller_button_down(self, button):\\n        if button == sdl2.SDL_CONTROLLER_BUTTON_DPAD_RIGHT:\\n                world.focus.focus_right()\\n        elif button == sdl2.SDL_CONTROLLER_BUTTON_DPAD_LEFT:\\n                world.focus.focus_left()\\n        elif button == sdl2.SDL_CONTROLLER_BUTTON_DPAD_UP:\\n                world.focus.focus_up()\\n        elif button == sdl2.SDL_CONTROLLER_BUTTON_DPAD_DOWN:\\n                world.focus.focus_down()\\n\\n    def on_character(self, char):\\n        if self.input:\\n            if self.operator == '/':\\n                self.query += chr(char)\\n                return\\n            elif self.operator == 'r':\\n                self.input.delete_char('right')\\n                self.input.insert_char(chr(char), move_caret=False)\\n                self.operator = ''\\n                return\\n        return super().on_character(char)\\n\\n    def on_keyboard(self, key, scancode, action, mods):\\n        result = False\\n        if action == 1:\\n            if world.apps['Menus'].active_menu:\\n                if key == sdl2.SDLK_ESCAPE:\\n                    world.apps['Menus'].active_menu.close()\\n                    result = True\\n            elif key == sdl2.SDLK_TAB:\\n                if mods == 0:\\n                    world.focus.focus_next()\\n                elif mods in (1, 2):\\n                    world.focus.focus_previous()\\n            elif (key == sdl2.SDLK_h and mods in (1, 2)) or key == sdl2.SDLK_LEFT:\\n                world.focus.focus_left()\\n            elif (key == sdl2.SDLK_l and mods in (1, 2)) or key == sdl2.SDLK_RIGHT:\\n                world.focus.focus_right()\\n            elif (key == sdl2.SDLK_j and mods in (1, 2)) or key == sdl2.SDLK_DOWN:\\n                world.focus.focus_down()\\n            elif (key == sdl2.SDLK_k and mods in (1, 2)) or key == sdl2.SDLK_UP:\\n                world.focus.focus_up()\\n            elif self.input:\\n                result = True\\n                count = int(self.count) if self.count else None\\n                if key == sdl2.SDLK_ESCAPE:\\n                    self.reset()\\n                    self.query = ''\\n                elif self.operator == '/':\\n                    if key == sdl2.SDLK_BACKSPACE:\\n                        self.query = self.query[:-1]\\n                    elif key == sdl2.SDLK_RETURN:\\n                        self.operator = ''\\n                        self.input.search(self.query)\\n                elif self.operator == 'r':\\n                    pass\\n                elif mods == 65: # ctrl + shift\\n                    if key == sdl2.SDLK_c:\\n                        world.apps['Clipboard'].set_text(self.input.text)\\n                    elif key == sdl2.SDLK_v:\\n                        self.input.insert_text(world.apps['Clipboard'].get_text())\\n                elif key == sdl2.SDLK_y:\\n                    if self.operator == 'y':\\n                        Y('\\\\n'.join(self.input.get_lines(count or 1)), 'V')\\n                        self.reset()\\n                    else:\\n                        self.operator = 'y'\\n                elif key == sdl2.SDLK_p:\\n                    regtype = Y.register_type\\n                    if regtype == 'v':\\n                        self.input.insert_text(Y.value)\\n                    elif regtype == 'V':\\n                        self.input.insert_text(Y.value, linewise=True)\\n                    else:\\n                        raise Exception(f'unsupported register type: {regtype}')\\n                elif key == sdl2.SDLK_i:\\n                    world.vim._ignore_next_char = True\\n                    world.vim.set_current_mode('insert')\\n                    self.reset()\\n                elif key == sdl2.SDLK_o:\\n                    if self.input.multiline:\\n                        if mods in (1, 2):\\n                            self.input.insert_char('\\\\n')\\n                            world.vim._ignore_next_char = True\\n                            world.vim.set_current_mode('insert')\\n                            self.input.move_caret('up', 1)\\n                            self.input.match_indent()\\n                        else:\\n                            self.input.move_caret_to_line_end()\\n                            world.vim._ignore_next_char = True\\n                            world.vim.set_current_mode('insert')\\n                            self.input.move_caret('right', 1)\\n                            self.input.insert_char('\\\\n')\\n                            self.input.match_indent()\\n                        self.reset()\\n                elif key == sdl2.SDLK_EQUALS:\\n                    if self.input.multiline:\\n                        self.input.match_indent()\\n                elif key == sdl2.SDLK_r:\\n                    world.vim._ignore_next_char = True\\n                    self.operator = 'r'\\n                elif key == sdl2.SDLK_SLASH:\\n                    world.vim._ignore_next_char = True\\n                    self.operator = '/'\\n                elif key == sdl2.SDLK_a:\\n                    if mods in (1, 2):\\n                        self.input.move_caret_to_line_end()\\n                    world.vim._ignore_next_char = True\\n                    world.vim.set_current_mode('insert')\\n                    self.input.move_caret('right', 1)\\n                    self.reset()\\n                elif key == sdl2.SDLK_h:\\n                    self.input.move_caret('left', count or 1)\\n                    self.reset()\\n                elif key == sdl2.SDLK_l:\\n                    self.input.move_caret('right', count or 1)\\n                    self.reset()\\n                elif key == sdl2.SDLK_j:\\n                    self.input.move_caret('down', count or 1)\\n                    self.reset()\\n                elif key == sdl2.SDLK_k:\\n                    self.input.move_caret('up', count or 1)\\n                    self.reset()\\n                elif key == sdl2.SDLK_n:\\n                    if self.query:\\n                        self.input.search(self.query, reverse=True if mods == 1 else False)\\n                elif key == sdl2.SDLK_w:\\n                    if not self.operator:\\n                        for _ in range(count or 1):\\n                            self.input.move_caret_to_next_word()\\n                    elif self.operator == 'd':\\n                        self.input.delete_n_next_words(count or 1)\\n                    elif self.operator == 'c':\\n                        self.input.delete_n_next_words(count or 1)\\n                        world.vim.set_current_mode('insert')\\n                        world.vim._ignore_next_char = True\\n                    self.reset()\\n                elif key == sdl2.SDLK_b:\\n                    for _ in range(count or 1):\\n                        self.input.move_caret_to_previous_word()\\n                    self.reset()\\n                elif key == sdl2.SDLK_c:\\n                    if not self.operator:\\n                        self.operator = 'c'\\n                elif key == sdl2.SDLK_d:\\n                    if self.operator == 'd':\\n                        Y('\\\\n'.join(self.input.get_lines(count or 1)), 'V')\\n                        self.input.delete_lines(count or 1)\\n                        self.reset()\\n                    else:\\n                        self.operator = 'd'\\n                elif key == sdl2.SDLK_z:\\n                    if self.operator == 'z':\\n                        self.input.center_current_line()\\n                        self.reset()\\n                    elif not self.operator:\\n                        self.operator = 'z'\\n                elif key == sdl2.SDLK_x:\\n                    self.input.delete_char('right')\\n                    self.input.move_caret_to(self.input.caret_location)\\n                elif key == sdl2.SDLK_0:\\n                    if not self.count:\\n                        self.input.move_caret_to_line_start()\\n                    else:\\n                        self.count += '0'\\n                elif key == sdl2.SDLK_4 and mods in (1, 2):\\n                    self.input.move_caret_to_line_end()\\n                elif key == sdl2.SDLK_g and mods in (1, 2):\\n                    if count:\\n                        self.input.move_caret_to((self.input.caret_location[0], count-1))\\n                    else:\\n                        self.input.move_caret_to_last_line()\\n                    self.reset()\\n                elif key == sdl2.SDLK_1:\\n                    self.count += '1'\\n                elif key == sdl2.SDLK_2:\\n                    self.count += '2'\\n                elif key == sdl2.SDLK_3:\\n                    self.count += '3'\\n                elif key == sdl2.SDLK_4:\\n                    self.count += '4'\\n                elif key == sdl2.SDLK_5:\\n                    self.count += '5'\\n                elif key == sdl2.SDLK_6:\\n                    self.count += '6'\\n                elif key == sdl2.SDLK_7:\\n                    self.count += '7'\\n                elif key == sdl2.SDLK_8:\\n                    self.count += '8'\\n                elif key == sdl2.SDLK_9:\\n                    self.count += '9'\\n                elif key == sdl2.SDLK_g:\\n                    if not self.prefix:\\n                        self.prefix = 'g'\\n                    else:\\n                        self.input.move_caret_to_first_line()\\n                        self.reset()\\n                elif key == sdl2.SDLK_RETURN and mods == 64:\\n                    self.reset()\\n                    self.input.submit()\\n                else:\\n                    result = False\\n        if not result:\\n            result = super().on_keyboard(key, scancode, action, mods)\\n        return result\\n\", \"name\": \"NormalVimMode\"}", "created_at": null, "updated_at": 1754736945.4605155}