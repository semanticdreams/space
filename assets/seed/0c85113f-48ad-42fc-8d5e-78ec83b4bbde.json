{"id": "0c85113f-48ad-42fc-8d5e-78ec83b4bbde", "type": "class", "data": "{\"code_str\": \"class GraphEntityNode(z.DynamicGraphNode):\\n    def __init__(self, entity):\\n        super().__init__(\\n            key = f'entity:{entity.id}',\\n            label='graph-entity',\\n            color=(1, 0.4, 1, 1),\\n            sub_color=(1, 0.4, 1, 1),\\n            view=z.GraphEntityNodeView,\\n        )\\n        self.entity = entity\\n\\n        self.entity.changed.connect(self.update_graph)\\n\\n        self.entity_node_map = {}\\n\\n    def show_all(self):\\n        for node_id in self.entity.nodes:\\n            try:\\n                entity = world.apps['Entities'].get_entity(node_id)\\n            except z.EntityNotFoundError:\\n                self.entity.remove_node(node_id)\\n            else:\\n                if entity.id not in self.entity_node_map:\\n                    node = z.GraphEntityNodeNode(self.entity, entity)\\n                    self.entity_node_map[entity.id] = node\\n                    self.dynamic_graph.add_node(node,\\n                                                update_force_layout=False)\\n        self.entity.save(emit_changed=False)\\n        for edge in self.entity.edges:\\n            source_entity = world.apps['Entities'].get_entity(edge['source_id'])\\n            target_entity = world.apps['Entities'].get_entity(edge['target_id'])\\n            if source_entity and target_entity:\\n                self.dynamic_graph.add_edge(z.DynamicGraphEdge(\\n                    source=self.entity_node_map[source_entity.id],\\n                    target=self.entity_node_map[target_entity.id],\\n                    label=edge['label']\\n                ), update_force_layout=False)\\n\\n        self.dynamic_graph.update_force_layout()\\n\\n    def hide_all(self):\\n        for node in self.entity_node_map.values():\\n            self.dynamic_graph.remove_node(node, update_force_layout=False,\\n                                           clear_broken_edges=False)\\n        self.entity_node_map.clear()\\n        self.dynamic_graph.clear_broken_edges()\\n        self.dynamic_graph.update_force_layout()\\n\\n    def update_graph(self):\\n        self.hide_all()\\n        self.show_all()\\n\\n    def drop(self):\\n        self.entity.changed.disconnect(self.update_graph)\\n\", \"name\": \"GraphEntityNode\"}", "created_at": null, "updated_at": 1754239007.5004354}