{"id": "236", "type": "class", "data": "{\"code_str\": \"class Text:\\n    def __init__(self, text, hud=False, style=None, min_width=None):\\n        self.hud = hud\\n        self.style = style or z.TextStyle()\\n        self.min_width = min_width\\n        self.text = text\\n        self.spans = []\\n        self.layout = z.Layout([], measurer=self.measurer, layouter=self.layouter, name='text')\\n        self.dirty = {'text'}\\n        self.update_text()\\n\\n    def set(self, text): # TODO tmp\\n        self.set_text(text)\\n\\n    def set_hud(self, hud):\\n        for span in self.spans:\\n            span.set_hud(hud)\\n        self.hud = hud\\n\\n    def set_text(self, text):\\n        self.text = text\\n        self.dirty.add('text')\\n        self.update_text()\\n        self.layout.mark_measure_dirty()\\n\\n    def update_text(self):\\n        if 'text' in self.dirty:\\n            self.layout.clear_children() # TODO can this be avoided\\n            lines = self.text.split('\\\\n')\\n            for span in self.spans[len(lines):]:\\n                span.drop()\\n            self.spans = self.spans[:len(lines)]\\n            for span, line in zip(self.spans, lines):\\n                span.set_text(line, mark_layout_measure_dirty=False)\\n            for line in lines[len(self.spans):]:\\n                self.spans.append(z.TextSpan(line, hud=self.hud, style=self.style))\\n            self.layout.set_children([x.layout for x in self.spans])\\n            self.dirty.remove('text')\\n\\n    def measurer(self):\\n        #self.update_text()\\n        self.layout.measure = np.array((0, 0, 0), float)\\n        for child in self.layout.children:\\n            child.measurer()\\n            self.layout.measure[0] = max(self.layout.measure[0], child.measure[0])\\n            self.layout.measure[1] += child.measure[1]\\n        self.layout.measure[1] += 0.5 * (len(self.layout.children) - 1) # TODO should use font's linegap\\n        if self.min_width:\\n            self.layout.measure[0] = max(\\n                self.layout.measure[0],\\n                self.style.font.glyph_map[32]['advance'] * self.style.scale * self.min_width\\n            )\\n\\n    def layouter(self):\\n        y = self.layout.measure[1]\\n        for child in self.layout.children:\\n            y -= child.measure[1]\\n            child.depth_offset_index = self.layout.depth_offset_index\\n            child.rotation = self.layout.rotation\\n            child.position = self.layout.position \\\\\\n                    + transformations.rotate_vector(self.layout.rotation, np.array([0, y, 0], float))\\n            child.layouter()\\n            y -= 0.5 # TODO should use font's linegap\\n\\n    def drop(self):\\n        self.layout.drop()\\n        for span in self.spans:\\n            span.drop()\\n\", \"name\": \"Text\"}", "created_at": null, "updated_at": 1754239007.499482}