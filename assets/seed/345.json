{"id": "345", "type": "class", "data": "{\"code_str\": \"import json\\nimport os\\nfrom OpenGL.GL import *\\nfrom PIL import Image\\nfrom ctypes import sizeof, c_float, c_void_p, c_uint, string_at\\n\\n\\nclass TextRenderer:\\n    def __init__(self):\\n        self.program = world.shaders.build_program(world.shaders.find_shader('msdf.vert'),\\n                                                   world.shaders.find_shader('msdf.frag'))\\n        self.projection_uniform = glGetUniformLocation(self.program, b'projection')\\n        self.view_uniform = glGetUniformLocation(self.program, b'view')\\n        self.pxrange_uniform = glGetUniformLocation(self.program, b'pxRange')\\n\\n        self.vao, self.vbo = self.create_buffers()\\n\\n    def create_buffers(self):\\n        vao = glGenVertexArrays(1)\\n        vbo = glGenBuffers(1)\\n        glBindVertexArray(vao)\\n        glBindBuffer(GL_ARRAY_BUFFER, vbo)\\n\\n        stride = 10 * sizeof(c_float)\\n\\n        # Position attribute\\n        glEnableVertexAttribArray(0)\\n        glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, stride, None)\\n\\n        # UV attribute\\n        glEnableVertexAttribArray(1)\\n        glVertexAttribPointer(1, 2, GL_FLOAT, GL_FALSE, stride, c_void_p(3 * sizeof(c_float)))\\n\\n        # Color attribute\\n        glEnableVertexAttribArray(2)\\n        glVertexAttribPointer(2, 4, GL_FLOAT, GL_FALSE, stride, c_void_p(5 * sizeof(c_float)))\\n\\n        # depth offset index\\n        glEnableVertexAttribArray(3)\\n        glVertexAttribPointer(3, 1, GL_INT, GL_FALSE, stride, c_void_p(9 * sizeof(c_float)))\\n\\n        #glBindBuffer(GL_ARRAY_BUFFER, 0)\\n        #glBindVertexArray(0)\\n        return vao, vbo\\n\\n    def render(self, view_matrix, projection_matrix, data, font):\\n        glBindVertexArray(self.vao)\\n        glBindBuffer(GL_ARRAY_BUFFER, self.vbo)\\n\\n        #array = np.array(self.text_vertices, np.float32)\\n        glBufferData(GL_ARRAY_BUFFER, data.nbytes, data, GL_STREAM_DRAW)\\n\\n        glUseProgram(self.program)\\n\\n        glUniformMatrix4fv(self.projection_uniform, 1, GL_FALSE, projection_matrix)\\n        glUniformMatrix4fv(self.view_uniform, 1, GL_FALSE, view_matrix)\\n        glUniform1f(self.pxrange_uniform, font.meta['atlas']['distanceRange'])\\n\\n        glActiveTexture(GL_TEXTURE0)\\n        glBindTexture(GL_TEXTURE_2D, font.texture)\\n        #glUniform1i(glGetUniformLocation(self.program, \\\"msdf\\\"), 0)\\n\\n        glDrawArrays(GL_TRIANGLES, 0, int(len(data) / 10))\\n\\n        glBindVertexArray(0)\\n        glUseProgram(0)\\n\", \"name\": \"TextRenderer\"}", "created_at": null, "updated_at": 1754239007.5072427}