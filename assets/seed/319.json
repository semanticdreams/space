{"id": "319", "type": "class", "data": "{\"code_str\": \"import itertools\\n\\n\\nclass Menu:\\n    counter = itertools.count()\\n\\n    def __init__(self, actions=None, focus_parent=None, position=None, constraints=None, hud=False,\\n                 sort=False):\\n        self.id = next(self.counter)\\n        self.world = world\\n        self.actions = dict(actions or [])\\n        self.focus_parent = focus_parent\\n        self.position = position\\n        self.constraints = constraints\\n        self.sort = sort\\n        self.hud = hud\\n        self.layout = None\\n\\n        self.active = False\\n        self.closed = z.Signal()\\n        self.opened = z.Signal()\\n        self.buttons = []\\n\\n        self.submenus = {}\\n\\n    def __repr__(self):\\n        return '<Menu: {}>'.format(self.id)\\n\\n    def set_action(self, name, func):\\n        self.actions[name] = func\\n\\n    def create_submenu(self, name, actions):\\n        menu = world.apps['Menus'].create_menu(actions)\\n        world.apps['Menus'].root.set_action(name, lambda: menu.show(position=self.position))\\n        self.submenus[name] = menu\\n\\n    def destroy_submenu(self, name):\\n        world.apps['Menus'].destroy_menu(self.submenus[name])\\n        world.apps['Menus'].root.unset_action(name)\\n\\n    def show(self, position=None):\\n        if not self.actions:\\n            return\\n        self.focus = self.focus_parent.add_child(obj=self) \\\\\\n                if self.focus_parent else world.focus.add_child(obj=self)\\n        actions = sorted(self.actions) if self.sort else self.actions\\n        for name in actions:\\n            func = self.actions[name]\\n            button = z.Button(text=name, focus_parent=self.focus, centered=False, hud=self.hud)\\n            button.clicked.connect(lambda p, r, i, name=name: self.button_clicked(name))\\n            self.buttons.append(button)\\n\\n        self.col = z.Flex([\\n            z.FlexChild(x.layout) for x in self.buttons\\n        ],\\n            axis='y', yalign='start', xalign='largest', yspacing=0)\\n\\n        self.flipped = z.ViewportAwareFlipPositioner(self.col.layout)\\n\\n        self.layout = self.flipped.layout\\n        world.apps['Menus'].layout.add_child(self.layout)\\n\\n        self.layout.position = position if position is not None else self.position\\n\\n        world.apps['Clickables'].register_left_click_void_callback(self.on_left_click_void)\\n\\n        self.active = True\\n\\n        self.layout.mark_measure_dirty()\\n\\n        self.opened.emit()\\n\\n    def on_left_click_void(self, pos, ray):\\n        self.close()\\n\\n    def hide(self):\\n        world.apps['Clickables'].unregister_left_click_void_callback(self.on_left_click_void)\\n        self.active = False\\n        world.apps['Menus'].layout.remove_child(self.layout)\\n        self.flipped.drop()\\n        self.col.drop()\\n        for button in self.buttons:\\n            button.clicked.clear_callbacks()\\n            button.drop()\\n        self.buttons.clear()\\n        if self.focus:\\n            self.focus.drop()\\n        self.layout = None\\n\\n    def button_clicked(self, name):\\n        self.close()\\n        self.actions[name]()\\n\\n    def close(self):\\n        self.closed.emit()\\n\\n    def drop(self):\\n        if self.active:\\n            self.hide()\\n\", \"name\": \"Menu\"}", "created_at": null, "updated_at": 1754736945.491018}