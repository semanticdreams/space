{"id": "176", "type": "class", "data": "{\"code_str\": \"import os\\nimport json\\nimport keyring\\nfrom keyring.backends import SecretService\\nfrom cryptography.fernet import Fernet\\n\\nkeyring.set_keyring(SecretService.Keyring())\\n\\n\\nclass Secrets:\\n    def __init__(self):\\n        self.path = os.path.join(world.datadir, 'secrets')\\n        self.secrets = None\\n        self.key = None\\n\\n    def ensure_key(self):\\n        if self.key is None:\\n            user = 'secrets-encryption-key'\\n            self.key = keyring.get_password('space', user)\\n            if self.key is None:\\n                self.key = Fernet.generate_key()\\n                keyring.set_password('space', user, self.key.decode())\\n\\n    def save(self):\\n        self.ensure_key()\\n        plain_content = json.dumps(self.secrets)\\n        cipher_suite = Fernet(self.key)\\n        content = cipher_suite.encrypt(plain_content.encode()).decode()\\n        with open(self.path, 'w') as f:\\n            f.write(content)\\n\\n    def load(self):\\n        self.ensure_key()\\n        if not os.path.isfile(self.path):\\n            self.secrets = {}\\n            return\\n        with open(self.path) as f:\\n            content = f.read()\\n        cipher_suite = Fernet(self.key)\\n        plain_content = cipher_suite.decrypt(content.encode()).decode()\\n        self.secrets = json.loads(plain_content)\\n\\n    def get(self, name):\\n        if self.secrets is None:\\n            self.load()\\n        return self.secrets[name]\\n\\n    def set(self, name, secret):\\n        if self.secrets is None:\\n            self.load()\\n        self.secrets[name] = secret\\n        self.save()\\n\\n    def drop(self):\\n        pass\\n\", \"name\": \"Secrets\"}", "created_at": null, "updated_at": 1754239007.5041387}