{"id": "371", "type": "class", "data": "{\"code_str\": \"class States:\\n    def __init__(self):\\n        self.state_count = 0\\n        self.states_list = []\\n        self.state_names = {}\\n        self.reverse_state_names = {}\\n        self.state_parents = {}\\n        self.entry_handlers = {}\\n        self.leave_handlers = {}\\n        self.active_states = []\\n        self.history = []\\n\\n        self.changed = z.Signal()\\n\\n        world.states = self\\n\\n    def get_status(self):\\n        return '/'.join((self.state_names.get(x, '-') for x in self.active_states))\\n\\n    def create_state(self, parent=None, name=None, on_enter=None, on_leave=None):\\n        #assert name\\n        id = self.state_count\\n        self.state_count += 1\\n        self.states_list.append(id)\\n        if parent:\\n            self.state_parents[id] = parent\\n        if name:\\n            assert name not in self.reverse_state_names\\n            self.state_names[id] = name\\n            self.reverse_state_names[name] = id\\n        self.entry_handlers[id] = on_enter\\n        self.leave_handlers[id] = on_leave\\n        return id\\n\\n    def drop_state(self, state_id):\\n        self.states_list.remove(state_id)\\n        name = self.state_names.pop(state_id)\\n        self.reverse_state_names.pop(name)\\n        del self.entry_handlers[state_id]\\n        del self.leave_handlers[state_id]\\n        # TODO parents - traverse?\\n\\n    def transit(self, state_id=None, state_name=None):\\n        id = state_id if state_id is not None else self.reverse_state_names[state_name]\\n        if self.active_states:\\n            self.history.append(self.active_states[0])\\n            for s in self.active_states:\\n                self.leave_handlers[s]()\\n        self.active_states = [id]\\n        self.entry_handlers[id]()\\n        self.changed.emit()\\n\\n    def is_state_active(self, state_id):\\n        return state_id in self.active_states\\n\\n    def transit_back(self):\\n        self.transit(state_id=self.history[-1])\\n        self.history = self.history[:-2]\\n\\n    def transit_next(self):\\n        raise NotImplementedError\\n\\n#    def to_next(self):\\n#        keys_list = list(self.root.keys())\\n#        index = keys_list.index(self.current)\\n#        if index < len(keys_list) - 1:\\n#            self.to(keys_list[index + 1])\\n\\n    def drop(self):\\n        pass\\n\", \"name\": \"States\"}", "created_at": null, "updated_at": 1756754129.7256126}