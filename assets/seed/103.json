{"id": "103", "type": "class", "data": "{\"code_str\": \"import os\\n\\n\\nclass FileSystemView:\\n    def __init__(self, path=None, focus_parent=world.focus):\\n        self.path = path or os.path.expanduser('~')\\n        self.show_hidden = False\\n\\n        self.focus = focus_parent.add_child(self, on_subtree_changed=self.on_focus_subtree_changed)\\n\\n        self.up_button = z.Button('^', focus_parent=self.focus)\\n        self.up_button.clicked.connect(self.up_button_clicked)\\n\\n        self.current_path_button = z.ContextButton(focus_parent=self.focus)\\n\\n        self.query = ''\\n        self.search_input = z.Input(focus_parent=self.focus)\\n        self.search_input.changed.connect(self.on_search_input_changed)\\n\\n        self.head = z.Flex(yalign='largest',\\n            children=[\\n                z.FlexChild(self.up_button.layout),\\n                z.FlexChild(self.current_path_button.layout),\\n                z.FlexChild(self.search_input.layout, flex=1)\\n            ]\\n        )\\n\\n        self.list_view = z.ListView(\\n            [],\\n            builder=self.builder,\\n            focus_parent=self.focus,\\n            show_head=False,\\n        )\\n\\n        self.column = z.Flex([\\n            z.FlexChild(self.head.layout),\\n            z.FlexChild(self.list_view.layout, flex=1)\\n        ], axis='y', xalign='largest')\\n\\n        self.layout = self.column.layout\\n\\n        self.go(self.path)\\n\\n        self.submitted = z.Signal()\\n\\n    def __str__(self):\\n        return f'<FileSystemView: {self.path}>'\\n\\n    def on_focus_subtree_changed(self, focused):\\n        if focused:\\n            world.window.keyboard.connect(self.on_keyboard)\\n        else:\\n            world.window.keyboard.disconnect(self.on_keyboard)\\n\\n    def on_keyboard(self, key, scancode, action, mods):\\n        if world.focus.current == self.search_input.focus:\\n            return\\n        if action == 1:\\n            if key == 104 and mods == 64:\\n                self.toggle_hidden()\\n            elif key in (sdl2.SDLK_BACKSPACE, sdl2.SDLK_LEFT):\\n                self.go_up()\\n            elif key == sdl2.SDLK_SLASH:\\n                world.focus.set_focus(self.search_input.focus)\\n                world.vim.set_current_mode('insert')\\n                world.vim._ignore_next_char = True\\n            elif key in (sdl2.SDLK_RIGHT, sdl2.SDLK_UP, sdl2.SDLK_DOWN):\\n                for child in self.list_view.column_focus.children:\\n                    if child.has_current_descendant():\\n                        if key == sdl2.SDLK_RIGHT:\\n                            self.go(child.obj.data)\\n                        elif key == sdl2.SDLK_DOWN:\\n                            world.focus.focus_next_sibling(child)\\n                        elif key == sdl2.SDLK_UP:\\n                            world.focus.focus_previous_sibling(child)\\n                        break\\n\\n    def up_button_clicked(self, f, i, d):\\n        self.go_up()\\n\\n    def go_up(self):\\n        self.go(os.path.dirname(self.path))\\n\\n    def on_search_input_changed(self, value):\\n        self.query = value\\n        self.update_items(focus_list=False)\\n\\n    def builder(self, item, context):\\n        filename = os.path.basename(item)\\n        root, ext = os.path.splitext(filename)\\n        is_file = os.path.isfile(item)\\n        actions = []\\n        if is_file:\\n            actions.append(('submit', lambda: self.submitted.emit(item)))\\n            if ext in ('.jpeg', '.jpg', '.png'):\\n                actions.append(('view image', lambda: world.floaties.add(z.ImageView(path=item))))\\n            else:\\n                actions.append(('edit', lambda: world.floaties.add(z.Editor(path=item))))\\n                actions.append(('edit with vim', lambda: world.dialogs.edit_file(item)))\\n        else:\\n            actions.append(('go', lambda: self.go(item)))\\n        actions.append(('pyobj', lambda: world.floaties.add(z.PyObjView(item))))\\n        actions.append(('with view', lambda: self.with_view(item)))\\n        return z.ContextButton(\\n            color=(0.9, 0.9, 0.3, 1) if is_file else (0.4, 0.9, 0.4, 1),\\n            label=filename,\\n            data=item,\\n            focus_parent=context['focus_parent'],\\n            actions=actions,\\n        )\\n\\n    def with_view(self, item):\\n        picker = world.classes['ClassPicker']()\\n        def cb(code):\\n            world.floaties.drop_obj(picker)\\n            cls = world.classes[code['name']]\\n            world.floaties.add(cls(item))\\n        picker.submitted.connect(cb)\\n        world.floaties.add(picker)\\n\\n    def get_children(self):\\n        return [os.path.join(self.path, x) for x in sorted(os.listdir(self.path))]\\n\\n    def toggle_hidden(self):\\n        self.show_hidden = not self.show_hidden\\n        self.go(self.path)\\n\\n    def go(self, item):\\n        if not os.path.isdir(item):\\n            return\\n        self.path = item\\n        self.is_file = os.path.isfile(self.path)\\n        self.search_input.set_text('')\\n        self.update_items()\\n\\n    def update_items(self, focus_list=True):\\n        self.list_view.set_items([x for x in self.get_children()\\n                                  if (self.show_hidden or not os.path.basename(x).startswith('.')) \\\\\\n                                  and z.fuzzy_match(self.query, os.path.basename(x))])\\n        self.current_path_button.set_label(self.path)\\n        if focus_list:\\n            world.focus.set_focus(self.list_view.focus)\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.head.drop()\\n        self.current_path_button.drop()\\n        self.search_input.drop()\\n        self.up_button.drop()\\n        self.list_view.drop()\\n        self.focus.drop()\", \"name\": \"FileSystemView\"}", "created_at": null, "updated_at": 1754239007.4994197}