{"id": "05d0a95e-bad3-4ffe-bdb9-756199bcf924", "type": "class", "data": "{\"code_str\": \"class GraphEntityNodeView:\\n    def __init__(self, node, focus_parent=world.focus):\\n        self.node = node\\n        self.focus = focus_parent.add_child(self)\\n\\n        self.actions = [\\n            ('icon:keep', self.on_pin_triggered),\\n        ]\\n\\n        self.actions_panel = z.ActionsPanel([\\n            ('show all', self.node.show_all),\\n            ('hide all', self.node.hide_all),\\n            ('copy entity', self.node.entity.copy),\\n            ('paste entity as node', self.paste_triggered),\\n            ('create entity', self.create_entity_triggered),\\n        ], focus_parent=self.focus)\\n\\n        self.link_source_entity = None\\n        self.link_target_entity = None\\n        self.link_label = z.Label('Link: ')\\n        self.link_source_button = z.Button('<paste source>', focus_parent=self.focus)\\n        self.link_source_button.clicked.connect(self.on_link_source_clicked)\\n        self.link_swap_button = z.Button('icon:swap_horiz', focus_parent=self.focus)\\n        self.link_swap_button.clicked.connect(self.on_link_swap_clicked)\\n        self.link_target_button = z.Button('<paste target>', focus_parent=self.focus)\\n        self.link_target_button.clicked.connect(self.on_link_target_clicked)\\n        self.link_submit_button = z.Button('submit', focus_parent=self.focus)\\n        self.link_submit_button.clicked.connect(self.on_link_submit_clicked)\\n        self.unlink_button = z.Button('unlink', focus_parent=self.focus)\\n        self.unlink_button.clicked.connect(self.on_unlink_clicked)\\n        self.link_row = z.Flex([\\n            z.FlexChild(self.link_label.layout),\\n            z.FlexChild(self.link_source_button.layout),\\n            z.FlexChild(self.link_swap_button.layout),\\n            z.FlexChild(self.link_target_button.layout),\\n            z.FlexChild(self.link_submit_button.layout),\\n            z.FlexChild(self.unlink_button.layout),\\n        ], yalign='largest')\\n\\n        self.column = z.Flex([\\n            z.FlexChild(self.actions_panel.layout),\\n            z.FlexChild(self.link_row.layout),\\n        ], axis='y', xalign='largest')\\n\\n        self.layout = self.column.layout\\n\\n        self.node.dynamic_graph.selected_nodes_changed.connect(\\n            self.on_dynamic_graph_selected_nodes_changed)\\n\\n    def on_dynamic_graph_selected_nodes_changed(self):\\n        selected_graph_entity_nodes = [\\n            x for x in self.node.dynamic_graph.selected_nodes\\n            if isinstance(x, z.GraphEntityNodeNode)\\n        ]\\n        if len(selected_graph_entity_nodes) == 2:\\n            source, target = selected_graph_entity_nodes\\n            self.set_source_entity(source.entity)\\n            self.set_target_entity(target.entity)\\n\\n    def on_pin_triggered(self):\\n        self.node.dynamic_graph.pin_node_view(self)\\n\\n    def paste_triggered(self):\\n        assert Y.register_type == 'entity', Y.register_type\\n        entity = Y.value\\n        self.node.entity.add_node(entity)\\n        self.node.entity.save()\\n\\n    def create_entity_triggered(self):\\n        def on_submitted(item):\\n            entity = item[0].create()\\n            self.node.entity.add_node(entity)\\n            self.node.entity.save()\\n        world.floaties.add(z.CreateEntityView(on_submitted=on_submitted))\\n\\n    def set_source_entity(self, entity):\\n        self.link_source_entity = entity\\n        self.link_source_button.set_text(f'source: {self.link_source_entity}')\\n\\n    def set_target_entity(self, entity):\\n        self.link_target_entity = entity\\n        self.link_target_button.set_text(f'target: {self.link_target_entity}')\\n\\n    def on_link_source_clicked(self, f, i, d):\\n        assert Y.register_type == 'entity', Y.register_type\\n        self.set_source_entity(Y.value)\\n\\n    def on_link_target_clicked(self, f, i, d):\\n        assert Y.register_type == 'entity', Y.register_type\\n        self.set_target_entity(Y.value)\\n\\n    def on_link_swap_clicked(self, f, i, d):\\n        tmp = self.link_source_entity\\n        self.set_source_entity(self.link_target_entity)\\n        self.set_target_entity(tmp)\\n\\n    def on_link_submit_clicked(self, f, i, d):\\n        assert self.link_source_entity and self.link_target_entity\\n        self.node.entity.add_edge(self.link_source_entity, self.link_target_entity)\\n        self.node.entity.save()\\n\\n    def on_unlink_clicked(self, f, i, d):\\n        assert self.link_source_entity and self.link_target_entity\\n        self.node.entity.remove_edge(self.link_source_entity, self.link_target_entity)\\n        self.node.entity.save()\\n\\n    def drop(self):\\n        self.node.dynamic_graph.selected_nodes_changed.disconnect(\\n            self.on_dynamic_graph_selected_nodes_changed)\\n        self.column.drop()\\n        self.link_row.drop()\\n        self.link_label.drop()\\n        self.link_source_button.drop()\\n        self.link_swap_button.drop()\\n        self.link_target_button.drop()\\n        self.link_submit_button.drop()\\n        self.unlink_button.drop()\\n        self.actions_panel.drop()\\n        self.focus.drop()\\n\", \"name\": \"GraphEntityNodeView\"}", "created_at": null, "updated_at": 1754239007.5053484}