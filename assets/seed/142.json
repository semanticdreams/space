{"id": "142", "type": "class", "data": "{\"code_str\": \"import ast\\nclass CodeView:\\n    def __init__(self, code):\\n        self.code = code\\n        self.focus = world.focus.add_child(self)\\n        actions = [\\n            ('edit', self.edit_triggered),\\n            ('ast', self.ast_triggered),\\n            ('run', self.run_triggered),\\n            ('archive', self.archive_triggered),\\n        ]\\n        self.name_input = z.Input(text=self.code['name'] or '', focus_parent=self.focus)\\n        self.name_input.submitted.connect(self.on_name_submitted)\\n        self.buttons = []\\n        for name, func in actions:\\n            button = z.Button(name, focus_parent=self.focus)\\n            button.clicked.connect(lambda f, i, d, func=func: func())\\n            self.buttons.append(button)\\n        self.spacer = z.Spacer()\\n        self.head = z.Flex(children=[\\n            z.FlexChild(self.name_input.layout),\\n            *[z.FlexChild(x.layout) for x in self.buttons],\\n            z.FlexChild(self.spacer.layout, flex=1)\\n        ])\\n        self.input = z.Input(text=code['code'], focus_parent=self.focus, tabs=True,\\n                                     multiline=True, actions=[\\n            ('copy', self.copy_to_clipboard),\\n            ('paste', self.paste_from_clipboard),\\n        ])\\n        self.input.submitted.connect(self.on_code_submitted)\\n        self.column = z.Flex([z.FlexChild(self.head.layout), z.FlexChild(self.input.layout)], axis='y', xalign='largest')\\n        self.layout = self.column.layout\\n\\n        self.output_view = None\\n\\n    def get_name(self):\\n        return f'Code: {self.code[\\\"id\\\"]}'\\n\\n    def copy_to_clipboard(self):\\n        world.apps['Clipboard'].set_text(self.input.text)\\n\\n    def paste_from_clipboard(self):\\n        self.input.set_text(world.apps['Clipboard'].get_text())\\n\\n    def update_code(self):\\n        self.code = world.codes.get_code(self.code['id'])\\n        self.input.set_text(self.code['code'])\\n\\n    def edit_triggered(self):\\n        world.codes.edit_code(self.code)\\n        self.update_code()\\n\\n    def archive_triggered(self):\\n        world.codes.archive_code(self.code)\\n        world.floaties.drop_obj(self)\\n\\n    def on_name_submitted(self):\\n        self.code['name'] = self.name_input.text\\n        world.codes.update_code_name(self.code)\\n\\n    def on_code_submitted(self):\\n        self.code['code'] = self.input.text\\n        world.codes.update_code(self.code)\\n        self.update_code()\\n\\n    def ast_triggered(self):\\n        AstNodeView = world.classes.get_class(name='AstNodeView')\\n        world.floaties.add(AstNodeView(ast.parse(self.code['code'])))\\n\\n    def run_triggered(self):\\n        kernel = world.kernels.ensure_kernel(self.code['kernel'])\\n        try:\\n            result = kernel.send_code(self.code, catch_errors=False)\\n        except Exception as e:\\n            world.floaties.add(z.PyErrorView(e))\\n        else:\\n            if result['output']:\\n                if not self.output_view:\\n                    CodeOutputView = world.classes['CodeOutputView']\\n                    self.output_view = CodeOutputView()\\n                    self.output_view.dropped.connect(self.on_output_view_dropped)\\n                    world.floaties.add(self.output_view)\\n                self.output_view.set_output(result['output'])\\n\\n    def on_output_view_dropped(self):\\n        self.output_view = None\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.head.drop()\\n        self.name_input.drop()\\n        self.spacer.drop()\\n        self.input.drop()\\n        for button in self.buttons:\\n            button.drop()\\n        self.focus.drop()\\n\", \"name\": \"CodeView\"}", "created_at": null, "updated_at": 1754239007.5022578}