{"id": "347", "type": "class", "data": "{\"code_str\": \"import glob\\n\\nimport OpenGL\\nfrom OpenGL.GL import *\\nfrom PIL import Image\\n\\nimport numpy, math, sys, os\\n\\n\\nvertices = np.array([\\n    -1.0,  1.0, -1.0,\\n    -1.0, -1.0, -1.0,\\n     1.0, -1.0, -1.0,\\n     1.0, -1.0, -1.0,\\n     1.0,  1.0, -1.0,\\n    -1.0,  1.0, -1.0,\\n\\n    -1.0, -1.0,  1.0,\\n    -1.0, -1.0, -1.0,\\n    -1.0,  1.0, -1.0,\\n    -1.0,  1.0, -1.0,\\n    -1.0,  1.0,  1.0,\\n    -1.0, -1.0,  1.0,\\n\\n     1.0, -1.0, -1.0,\\n     1.0, -1.0,  1.0,\\n     1.0,  1.0,  1.0,\\n     1.0,  1.0,  1.0,\\n     1.0,  1.0, -1.0,\\n     1.0, -1.0, -1.0,\\n\\n    -1.0, -1.0,  1.0,\\n    -1.0,  1.0,  1.0,\\n     1.0,  1.0,  1.0,\\n     1.0,  1.0,  1.0,\\n     1.0, -1.0,  1.0,\\n    -1.0, -1.0,  1.0,\\n\\n    -1.0,  1.0, -1.0,\\n     1.0,  1.0, -1.0,\\n     1.0,  1.0,  1.0,\\n     1.0,  1.0,  1.0,\\n    -1.0,  1.0,  1.0,\\n    -1.0,  1.0, -1.0,\\n\\n    -1.0, -1.0, -1.0,\\n    -1.0, -1.0,  1.0,\\n     1.0, -1.0, -1.0,\\n     1.0, -1.0, -1.0,\\n    -1.0, -1.0,  1.0,\\n     1.0, -1.0,  1.0\\n])\\n\\n\\nclass SkyboxRenderer:\\n    def __init__(self):\\n        self.program = world.shaders.build_program(world.shaders.find_shader('skybox.vert'),\\n                                                   world.shaders.find_shader('skybox.frag'))\\n\\n        glUseProgram(self.program)\\n\\n        self.load_texture()\\n\\n        self.pMatrixUniform = glGetUniformLocation(self.program, b'projection')\\n        self.view_matrix_uniform = glGetUniformLocation(self.program, b'view')\\n\\n        self.vertex_data = np.array(vertices, np.float32)\\n\\n        self.vao = glGenVertexArrays(1)\\n        self.vbo = glGenBuffers(1)\\n\\n        glBindVertexArray(self.vao)\\n        glBindBuffer(GL_ARRAY_BUFFER, self.vbo)\\n\\n        glEnableVertexAttribArray(0)\\n        stride = 3 * 4\\n        glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, stride, None)\\n\\n        glBufferData(GL_ARRAY_BUFFER, self.vertex_data.nbytes, 101 * self.vertex_data,\\n                     GL_STATIC_DRAW)\\n\\n        self.set_skybox(world.settings.get_value('skybox/path'), save=False)\\n\\n    def set_skybox(self, path, save=True):\\n        if save:\\n            world.settings.set_value('skybox/path', path)\\n        if path is None:\\n            self.active = False\\n            return\\n        l = ['right', 'left', 'top', 'bottom', 'back', 'front']\\n        files = [glob.glob(f'{path}/{x}.*')[0] for x in l]\\n        glActiveTexture(GL_TEXTURE0)\\n        glBindTexture(GL_TEXTURE_CUBE_MAP, self.texture_id)\\n        for i, filename in enumerate(files):\\n            img = Image.open(filename)\\n            #img = Image.open(filename).rotate(180).transpose(Image.FLIP_LEFT_RIGHT)\\n            mode = GL_RGB if img.mode == 'RGB' else GL_RGBA\\n            glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, mode, img.size[0], img.size[1],\\n                         0, mode, GL_UNSIGNED_BYTE, np.asanyarray(img))\\n        glBindTexture(GL_TEXTURE_CUBE_MAP, 0)\\n        self.active = True\\n\\n    def load_texture(self):\\n        self.texture_id = glGenTextures(1)\\n        glActiveTexture(GL_TEXTURE0)\\n        glBindTexture(GL_TEXTURE_CUBE_MAP, self.texture_id)\\n\\n        glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR)\\n        glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR)\\n        glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE)\\n        glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE)\\n        glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE)\\n\\n        glBindTexture(GL_TEXTURE_CUBE_MAP, 0)\\n\\n    def render(self):\\n        if not self.active:\\n            return\\n        glDepthMask(GL_FALSE)\\n        view_matrix = world.camera.camera.get_view_matrix().copy()\\n        view_matrix[12] = 0.0\\n        view_matrix[13] = 0.0\\n        view_matrix[14] = 0.0\\n\\n        glBindVertexArray(self.vao)\\n\\n        glUseProgram(self.program)\\n\\n        glUniformMatrix4fv(self.pMatrixUniform, 1, GL_FALSE, world.projection.value)\\n        glUniformMatrix4fv(self.view_matrix_uniform, 1, GL_FALSE, view_matrix)\\n\\n        glActiveTexture(GL_TEXTURE0)\\n        glBindTexture(GL_TEXTURE_CUBE_MAP, self.texture_id)\\n\\n        glDrawArrays(GL_TRIANGLES, 0, int(len(self.vertex_data) / 3))\\n\\n        glDepthMask(GL_TRUE)\\n\\n    def drop(self):\\n        glDeleteTextures(1, self.texture_id)\", \"name\": \"SkyboxRenderer\"}", "created_at": null, "updated_at": 1751906432.738778}