{"id": "375", "type": "class", "data": "{\"code_str\": \"import os\\nimport sys\\nimport appdirs\\nimport subprocess\\nimport cProfile\\n\\n\\nclass Profiler:\\n    def __init__(self, name):\\n        self.name = name\\n\\n        self.dir = os.path.join(appdirs.user_data_dir('space'), 'prof')\\n        os.makedirs(self.dir, exist_ok=True)\\n        self.prof_filename = os.path.join(self.dir, f'{self.name}.prof')\\n        self.svg_filename = os.path.join(self.dir, f'{self.name}.svg')\\n\\n        self.gprof2dot = os.path.abspath(os.path.join(os.path.dirname(sys.executable), 'gprof2dot'))\\n        if not os.path.isfile(self.gprof2dot):\\n            # Can't see gprof in the local bin dir, we'll just have to hope it's on the path somewhere\\n            self.gprof2dot = 'gprof2dot'\\n\\n        self.profiler = cProfile.Profile()\\n\\n    def enable(self):\\n        self.profiler.enable()\\n\\n    def disable(self):\\n        self.profiler.disable()\\n\\n    def dump(self):\\n        self.profiler.dump_stats(self.prof_filename)\\n\\n    def svg(self):\\n        gprof2dot_args = [self.gprof2dot, \\\"-f\\\", \\\"pstats\\\", os.path.abspath(self.prof_filename)]\\n        dot_args = [\\\"dot\\\", \\\"-Tsvg\\\", \\\"-o\\\", self.svg_filename]\\n        with subprocess.Popen(gprof2dot_args, stdout=subprocess.PIPE) as pgprof:\\n            with subprocess.Popen(\\n                dot_args, stdin=pgprof.stdout, stdout=subprocess.PIPE, stderr=subprocess.PIPE\\n            ) as pdot:\\n                pgprof.stdout.close()  # Allow pgprof to receive a SIGPIPE if pdot exits\\n                pgprof.wait()\\n                pdot.wait()\\n                stdout, stderr = pdot.communicate()\\n                if pgprof.returncode != 0:\\n                    raise Exception(f\\\"gprof2dot failed with return code {pgprof.returncode}\\\")\\n                if pdot.returncode != 0:\\n                    raise Exception(f\\\"dot failed with return code {pdot.returncode}: {stderr.decode()}\\\")\\n\\n    def __enter__(self):\\n        self.profiler.enable()\\n        return self.profiler\\n\\n    def __exit__(self, exc_type, exc_value, traceback):\\n        self.profiler.disable()\\n        self.dump()\\n\", \"name\": \"Profiler\"}", "created_at": null, "updated_at": 1751906432.742894}