{"id": "225", "type": "class", "data": "{\"code_str\": \"import math\\n\\n\\nclass ListView:\\n    def __init__(self, items=None, builder=None, num_per_page=10, focus_parent=None,\\n                 name='list-view', show_head=False, paginate=True):\\n        self.name = name\\n        self.items = items or []\\n        self.show_head = show_head\\n        self.paginate = paginate\\n        self.builder = builder or self.default_builder\\n\\n        self.objs = []\\n\\n        self.focus = focus_parent.add_child(obj=self, on_changed=self.on_focus_changed) \\\\\\n                if focus_parent else world.focus.add_child(self, self.on_focus_changed)\\n\\n        if self.show_head:\\n            self.head = z.ContextButton(label=name, focus_parent=self.focus, actions=[\\n                ('custom builder', self.custom_builder_triggered),\\n            ], color=(1, 0.5, 1, 1))\\n\\n        self.column = z.Flex([], axis='y', xalign='largest')\\n        self.column_focus = self.focus.add_child(self.column)\\n\\n        if self.paginate:\\n            self.pagination = z.Pagination(len(self.items), focus_parent=self.focus, per_page=num_per_page)\\n            self.pagination.page_changed.connect(self.on_page_changed)\\n\\n        row_items = []\\n        if self.show_head:\\n            row_items.append(z.FlexChild(self.head.layout))\\n\\n        row_items.append(z.FlexChild(self.column.layout))\\n\\n        self.spacer = z.Spacer()\\n        row_items.append(z.FlexChild(self.spacer.layout, flex=1))\\n\\n        if self.paginate:\\n            row_items.append(z.FlexChild(self.pagination.layout))\\n\\n        self.row = z.Flex(row_items, axis='y', xalign='largest')\\n\\n        self.layout = self.row.layout\\n\\n        if self.show_head:\\n            self.spatiolator = z.Spatiolator(self.layout, self.head)\\n\\n        if self.paginate:\\n            self.pagination.set_page(0)\\n        else:\\n            self.update_items()\\n\\n    def default_builder(self, item, context):\\n        return z.ContextButton(\\n            label=str(item)[:100],\\n            focus_parent=context['focus_parent'],\\n            actions=[\\n                ('pyobj', lambda: world.floaties.add(z.PyObjView(item))),\\n            ]\\n        )\\n\\n    def custom_builder_triggered(self):\\n        raise Exception('not implemented: need SetBuilderView')\\n        world.floaties.add(z.CustomClassView(lambda cls: self.set_builder(cls)))\\n\\n    def set_builder(self, builder):\\n        self.builder = builder\\n        if self.paginate:\\n            self.pagination.set_page(self.pagination.current_page, force_update=True)\\n        else:\\n            self.update_items()\\n\\n    def on_focus_changed(self, value):\\n        pass\\n\\n    def set_items(self, items):\\n        self.items = items\\n        if self.paginate:\\n            self.pagination.set_num_items(len(items))\\n        else:\\n            self.update_items()\\n\\n    def set_name(self, name):\\n        self.name = name\\n        if self.show_head:\\n            self.head.set_label(self.name)\\n\\n    def drop_objs(self):\\n        for obj in self.objs:\\n            obj.drop()\\n        self.objs.clear()\\n\\n    def update_items(self):\\n        self.column.clear_children()\\n        self.drop_objs()\\n        self.objs = [self.builder(item, context=dict(focus_parent=self.column_focus)) for item in self.items]\\n        self.column.set_children([\\n            z.FlexChild(obj.layout) for obj in self.objs\\n        ])\\n\\n    def on_page_changed(self, data):\\n        self.column.clear_children()\\n        self.drop_objs()\\n        start_index, stop_index = data['slice']\\n        current_items = self.items[start_index:stop_index]\\n        self.objs = [self.builder(item, context=dict(focus_parent=self.column_focus)) for item in current_items]\\n        self.column.set_children([\\n            z.FlexChild(obj.layout) for obj in self.objs\\n        ])\\n\\n    def drop(self):\\n        if self.focus:\\n            self.focus.disconnect()\\n        self.row.drop()\\n        self.spacer.drop()\\n        self.column.drop()\\n        self.drop_objs()\\n        if self.column_focus:\\n            self.column_focus.drop()\\n        if self.show_head:\\n            self.head.drop()\\n        if self.paginate:\\n            self.pagination.drop()\\n        if self.focus:\\n            self.focus.drop()\\n\", \"name\": \"ListView\"}", "created_at": null, "updated_at": 1756754129.7309535}