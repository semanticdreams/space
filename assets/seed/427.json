{"id": "427", "type": "class", "data": "{\"code_str\": \"class DictEntityView:\\n    def __init__(self, entity, focus_parent=None):\\n        self.focus = (focus_parent or world.focus).add_child(self)\\n        self.entity = entity\\n\\n        self.actions_panel = z.ActionsPanel([\\n            ('copy entity', self.entity.copy),\\n            ('delete', self.entity.delete),\\n            ('paste key entity', self.paste_triggered),\\n        ], focus_parent=self.focus)\\n\\n        self.pairs_column = z.Flex([], axis='y', xalign='largest')\\n        self.column = z.Flex([\\n            z.FlexChild(self.actions_panel.layout),\\n            z.FlexChild(self.pairs_column.layout, flex=1)\\n        ], axis='y', xalign='largest')\\n\\n        self.layout = self.column.layout\\n        self.objs = []\\n        self.update_items()\\n\\n    def __str__(self):\\n        return str(self.entity)\\n\\n    def update_items(self):\\n        self.drop_objs()\\n        for item in self.entity.dict_items:\\n            key = world.apps['Entities'].get_entity(item['key_entity_id'])\\n            value = world.apps['Entities'].get_entity(item['value_entity_id']) if item['value_entity_id'] is not None else None\\n            obj = z.DictEntityViewChild(self, key, value, focus_parent=self.focus)\\n            self.objs.append(obj)\\n        self.pairs_column.set_children([z.FlexChild(o.layout) for o in self.objs])\\n\\n    def drop_objs(self):\\n        self.pairs_column.clear_children()\\n        for obj in self.objs:\\n            obj.drop()\\n        self.objs.clear()\\n\\n    def paste_triggered(self):\\n        assert Y.register_type == 'entity'\\n        key = Y.value\\n        self.entity.add_dict_item(key, None)\\n        self.update_items()\\n\\n    def remove_pair(self, key_entity):\\n        self.entity.remove_dict_item(key_entity)\\n        self.update_items()\\n\\n    def set_pair_value(self, key_entity, value_entity):\\n        with world.db:\\n            world.db.execute(\\n                'update dict_items set value_entity_id = ? where dict_id = ? and key_entity_id = ?',\\n                (value_entity.id, self.entity.item_id, key_entity.id)\\n            )\\n        for item in self.entity.dict_items:\\n            if item['key_entity_id'] == key_entity.id:\\n                item['value_entity_id'] = value_entity.id\\n        self.update_items()\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.actions_panel.drop()\\n        self.pairs_column.drop()\\n        self.drop_objs()\\n        self.focus.drop()\\n\\n\", \"name\": \"DictEntityView\"}", "created_at": null, "updated_at": 1751906432.7457066}