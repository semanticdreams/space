{"id": "460", "type": "class", "data": "{\"code_str\": \"import ast, re\\n\\n\\nclass ClassEntityView:\\n    def __init__(self, entity, focus_parent=None):\\n        self.focus = (focus_parent or world.focus).add_child(self)\\n        self.entity = entity\\n\\n        self.actions_panel = z.ActionsPanel([\\n            ('copy entity', self.entity.copy),\\n            ('paste method', self.paste_method_triggered),\\n            ('launch as floatie', self.launch_triggered),\\n            ('clone', self.clone),\\n            ('delete', self.delete_class),\\n        ], focus_parent=self.focus)\\n\\n        self.code_input = z.Input(self.entity.code_str, multiline=True, min_lines=3, max_lines=10, syntax_coloring=True, tabs=True)\\n        self.code_input.submitted.connect(self.code_input_submitted)\\n\\n        self.column = z.Flex([\\n            z.FlexChild(self.actions_panel.layout),\\n            z.FlexChild(self.code_input.layout, flex=1)\\n        ], axis='y', xalign='largest')\\n\\n        self.layout = self.column.layout\\n\\n    def code_input_submitted(self):\\n        new_code_str = self.code_input.text.strip()\\n        ast.parse(new_code_str)\\n        new_name = self.entity.name\\n        m = re.search('class\\\\\\\\s+(\\\\\\\\w+)\\\\\\\\s*(\\\\\\\\(.*\\\\\\\\))?:', new_code_str)\\n        if m:\\n            new_name = m.group(1)\\n        self.entity.code_str = new_code_str\\n        self.entity.name = new_name\\n        self.entity.save()\\n\\n    def paste_method_triggered(self):\\n        assert Y.register_type == 'entity'\\n        entity = Y.value\\n        assert entity.type in ('code', 'function')\\n        if entity.type == 'code':\\n            wrapped_code = f\\\"def new_method(self):\\\\n\\\" + \\\"\\\\n\\\".join(f\\\"    {line}\\\" for line in entity.code_str.splitlines())\\n            wrapped_ast = ast.parse(wrapped_code)\\n            new_method = wrapped_ast.body[0]\\n            assert isinstance(new_method, ast.FunctionDef)\\n        else:\\n            raise NotImplementedError\\n        class_ast = ast.parse(self.code_input.text)\\n        for node in class_ast.body:\\n            if isinstance(node, ast.ClassDef):\\n                node.body.append(new_method)\\n                break\\n        else:\\n            raise ValueError(\\\"No class definition found in the provided class code.\\\")\\n        new_class_code = ast.unparse(class_ast)\\n        self.code_input.set_text(new_class_code)\\n        self.entity.code_str = new_class_code\\n        self.entity.save()\\n\\n    def launch_triggered(self):\\n        world.floaties.add(self.entity.eval()())\\n\\n    def __str__(self):\\n        return str(self.entity)\\n\\n    def clone(self):\\n        cloned = self.entity.clone()\\n        world.floaties.add(cloned.view(cloned))\\n\\n    def delete_class(self):\\n        self.entity.delete()\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.actions_panel.drop()\\n        self.code_input.drop()\\n        self.focus.drop()\\n\", \"name\": \"ClassEntityView\"}", "created_at": null, "updated_at": 1756754129.7232702}