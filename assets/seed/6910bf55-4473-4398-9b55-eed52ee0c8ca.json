{"id": "6910bf55-4473-4398-9b55-eed52ee0c8ca", "type": "class", "data": "{\"code_str\": \"from OpenGL.GL import *\\nfrom OpenGL.GL.shaders import compileProgram, compileShader\\n\\n\\nclass LuaWorld:\\n    vertex_shader_source = \\\"\\\"\\\"\\n    #version 330 core\\n    layout(location = 0) in vec3 position;\\n    layout(location = 1) in vec2 texCoords;\\n\\n    uniform mat4 projection;\\n    uniform mat4 view;\\n\\n    out vec2 TexCoords;\\n\\n    void main()\\n    {\\n        TexCoords = texCoords;\\n        gl_Position = projection * view * vec4(position, 1.0);\\n    }\\n    \\\"\\\"\\\"\\n\\n    fragment_shader_source = \\\"\\\"\\\"\\n    #version 330 core\\n    out vec4 FragColor;\\n    in vec2 TexCoords;\\n\\n    uniform sampler2D screenTexture;\\n\\n    void main()\\n    {\\n        FragColor = texture(screenTexture, TexCoords);\\n    }\\n    \\\"\\\"\\\"\\n\\n    quad_vertices = np.array([\\n        # positions   # texCoords\\n        0.0,  1.0, 0,  0.0, 1.0,\\n        0.0, 0.0, 0,  0.0, 0.0,\\n        1.0, 0.0, 0,  1.0, 0.0,\\n        0.0,  1.0,0,   0.0, 1.0,\\n        1.0, 0.0,  0, 1.0, 0.0,\\n        1.0,  1.0, 0,  1.0, 1.0\\n    ], dtype=np.float32)\\n\\n    def __init__(self):\\n        self.shader = compileProgram(\\n            compileShader(self.vertex_shader_source, GL_VERTEX_SHADER),\\n            compileShader(self.fragment_shader_source, GL_FRAGMENT_SHADER)\\n        )\\n\\n        self.width, self.height = world.viewport.value[2:4]\\n\\n        self.fbo, self.screen_texture = self.create_framebuffer(self.width, self.height)\\n\\n        self.create_quad()\\n\\n    def viewport_changed(self, viewport):\\n        self.width, self.height = world.viewport.value[2:4]\\n        glDeleteFramebuffers(1, self.fbo)\\n        glDeleteTextures(self.screen_texture)\\n        self.fbo, self.screen_texture = self.create_framebuffer(self.width, self.height)\\n\\n    def render(self, view, projection):\\n        glUseProgram(self.shader)\\n        glBindVertexArray(self.quad_vao)\\n        glActiveTexture(GL_TEXTURE0)\\n        glBindTexture(GL_TEXTURE_2D, self.screen_texture)\\n        glUniform1i(glGetUniformLocation(self.shader, b\\\"screenTexture\\\"), 0)\\n        glUniform2f(glGetUniformLocation(self.shader, b\\\"resolution\\\"), float(self.width), float(self.height))\\n        glUniformMatrix4fv(\\n            glGetUniformLocation(self.shader, b'projection'), 1, GL_FALSE, projection)\\n        glUniformMatrix4fv(\\n            glGetUniformLocation(self.shader, b'view'), 1, GL_FALSE, view)\\n        glDrawArrays(GL_TRIANGLES, 0, 6)\\n\\n    def drop(self):\\n        glDeleteFramebuffers(1, self.fbo)\\n        glDeleteTextures(self.screen_texture)\\n        glDeleteVertexArrays(self.quad_vao)\\n        glDeleteProgram(self.shader)\\n\\n    def create_framebuffer(self, width, height):\\n        # Create Framebuffer\\n        fbo = glGenFramebuffers(1)\\n        glBindFramebuffer(GL_FRAMEBUFFER, fbo)\\n\\n        # Create Texture Attachment\\n        tex = glGenTextures(1)\\n        glBindTexture(GL_TEXTURE_2D, tex)\\n        glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, None)\\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR)\\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR)\\n\\n        # Attach Texture to Framebuffer\\n        glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, tex, 0)\\n        #glDrawBuffers(1, [GL_COLOR_ATTACHMENT0])\\n\\n        # Create Renderbuffer Object for Depth & Stencil\\n        rbo = glGenRenderbuffers(1)\\n        glBindRenderbuffer(GL_RENDERBUFFER, rbo)\\n        glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH24_STENCIL8, width, height)\\n        glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_STENCIL_ATTACHMENT, GL_RENDERBUFFER, rbo)\\n\\n        assert glCheckFramebufferStatus(GL_FRAMEBUFFER) == GL_FRAMEBUFFER_COMPLETE\\n\\n        glBindFramebuffer(GL_FRAMEBUFFER, 0)\\n        return fbo, tex\\n\\n    def create_quad(self):\\n        vao = glGenVertexArrays(1)\\n        vbo = glGenBuffers(1)\\n        glBindVertexArray(vao)\\n        glBindBuffer(GL_ARRAY_BUFFER, vbo)\\n        glBufferData(GL_ARRAY_BUFFER, self.quad_vertices.nbytes, self.quad_vertices, GL_STREAM_DRAW)\\n        glEnableVertexAttribArray(0)\\n        glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 5 * self.quad_vertices.itemsize, ctypes.c_void_p(0))\\n        glEnableVertexAttribArray(1)\\n        glVertexAttribPointer(1, 2, GL_FLOAT, GL_FALSE, 5 * self.quad_vertices.itemsize, ctypes.c_void_p(12))\\n        glBindBuffer(GL_ARRAY_BUFFER, 0)\\n        glBindVertexArray(0)\\n        self.quad_vao = vao\\n        self.quad_vbo = vbo\\n\\n    def update_quad(self, layout):\\n        v = self.quad_vertices.copy()\\n        rotation_matrix = transformations.quaternion_matrix(\\n            layout.rotation)[:-1, :-1]\\n        size = np.array((layout.size[0], layout.size[1], 0))\\n        for i in range(0, v.size, 5):\\n            b = v[i:i+3]\\n            v[i:i+3] = np.matmul(rotation_matrix, (size * b)) \\\\\\n                    + layout.position\\n        glBindVertexArray(self.quad_vao)\\n        glBindBuffer(GL_ARRAY_BUFFER, self.quad_vbo)\\n        glBufferData(GL_ARRAY_BUFFER, v.nbytes, v, GL_STREAM_DRAW)\\n\", \"name\": \"LuaWorld\"}", "created_at": null, "updated_at": 1754736945.4870586}