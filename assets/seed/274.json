{"id": "274", "type": "class", "data": "{\"code_str\": \"class TasksView:\\n    def __init__(self, focus_parent=None):\\n        self.tasks = world.apps.ensure_app('Tasks')\\n        self.focus = focus_parent.add_child(self) if focus_parent else world.focus.add_child(self)\\n\\n        self.tree = z.TreeView(\\n            top_level_items=self.build_tree_items(),\\n            builder=self.tree_view_item_builder,\\n            focus_parent=self.focus\\n        )\\n        self.layout = self.tree.layout\\n\\n    def build_tree_items(self):\\n        items = []\\n        stack = [(None, None)]  # (task_data, parent_item)\\n\\n        while stack:\\n            task_data, parent_item = stack.pop()\\n\\n            if task_data is None:\\n                tasks = self.tasks.get_root_tasks()\\n                stack.extend((task, None) for task in reversed(tasks))\\n            else:\\n                item = z.TreeViewItem(item=task_data)\\n                if parent_item:\\n                    parent_item.children.append(item)\\n                else:\\n                    items.append(item)\\n\\n                children = self.tasks.get_child_tasks(task_data['id'])\\n                if children:\\n                    stack.extend((child, item) for child in reversed(children))\\n\\n        return items\\n\\n    def tree_view_item_builder(self, task_data, context):\\n        return z.ContextButton(\\n            label=f\\\"{task_data['label']} ({task_data['points']})\\\",\\n            focus_parent=context['focus_parent'],\\n            color=world.themes.theme.dialog_background_color,\\n            foreground_color=world.themes.theme.gray[100],\\n            #padding_insets=(0.5, 0.5),\\n            actions=[\\n                ('-', lambda: None),\\n                ('done', lambda: self.done(task_data)),\\n                ('edit label', lambda: self.edit_task_label(task_data)),\\n                ('edit points', lambda: self.edit_task_points(task_data)),\\n                ('add subtask', lambda: self.add_subtask(task_data)),\\n                ('archive', lambda: self.archive(task_data)),\\n            ]\\n        )\\n\\n    def done(self, task):\\n        self.tasks.set_task_done(task['id'], True)\\n        self.refresh()\\n\\n    def archive(self, task):\\n        self.tasks.set_task_archived(task['id'], True)\\n        self.refresh()\\n\\n    def edit_task_label(self, task):\\n        input = z.Input(text=task['label'], multiline=True)\\n        def on_submit():\\n            self.tasks.update_task_label(task['id'], input.text)\\n            self.refresh()\\n        input.submitted.connect(on_submit)\\n        world.floaties.add(input)\\n\\n    def edit_task_points(self, task):\\n        input = z.Input(text=str(task['points']), multiline=True)\\n        def on_submit():\\n            try:\\n                points = int(input.text)\\n                self.tasks.update_task_points(task['id'], points)\\n                self.refresh()\\n            except ValueError:\\n                pass\\n        input.submitted.connect(on_submit)\\n        world.floaties.add(input)\\n\\n    def add_subtask(self, parent):\\n        input = z.Input(multiline=True)\\n        def on_submit():\\n            self.tasks.create_task(input.text, 1, parent['id'])\\n            self.refresh()\\n        input.submitted.connect(on_submit)\\n        world.floaties.add(input)\\n\\n    def refresh(self):\\n        self.tree.set_top_level_items(self.build_tree_items())\\n        world.apps['TasksIndicator'].update_label()\\n\\n    def drop(self):\\n        self.tree.drop()\\n        if self.focus:\\n            self.focus.drop()\\n\", \"name\": \"TasksView\"}", "created_at": null, "updated_at": 1754239007.5028794}