{"id": "2eddd0e9-e434-477a-89f9-9440a55a165a", "type": "class", "data": "{\"code_str\": \"import math\\nimport operator\\n\\n\\nclass DovDial:\\n    threshold_radius = 0.9\\n    dialing_threshold = 0.8\\n\\n    def __init__(self):\\n        self.reset()\\n\\n    def get_sector_4(x, y):\\n        y = -y\\n        if y >= abs(x):\\n            return 0\\n        elif -y >= abs(x):\\n            return 2\\n        elif x >= abs(y):\\n            return 1\\n        elif -x >= abs(y):\\n            return 3\\n        assert False, (x, y)\\n\\n    def angle_between(angle, a, b):\\n        if a < b:\\n            return a <= angle and angle <= b\\n        return a <= angle or angle <= b\\n\\n    def norm_angle(angle):\\n        return (20.0 * math.pi + angle) % (2.0 * math.pi)\\n\\n    def sector_angles_8(narrowing_shift=0.1):\\n        #angles = [4.52, 5.3, 6.09, 0.59, 1.37, 2.16, 2.95, 3.73]\\n        angles = [4.32, 5.11, 5.89, 0.393, 1.1784, 1.9638, 2.7492, 3.5346]\\n        angles[0] += narrowing_shift\\n        angles[1] -= narrowing_shift\\n        angles[2] += narrowing_shift\\n        angles[3] -= narrowing_shift\\n        angles[4] += narrowing_shift\\n        angles[5] -= narrowing_shift\\n        angles[6] += narrowing_shift\\n        angles[7] -= narrowing_shift\\n        return angles\\n\\n    def angle_from_coordinates(x, y):\\n        return self.norm_angle(math.atan2(y, x))\\n\\n    def get_sector_8(x, y, sector_angles=None):\\n        sector_angles = sector_angles or self.sector_angles_8()\\n        angle = self.angle_from_coordinates(x, y)\\n        l = list(range(9))\\n        for i, (a, b) in enumerate(zip(l, l[1:])):\\n            b %= 8\\n            if self.angle_between(angle, sector_angles[a], sector_angles[b]):\\n                return i\\n\\n    def test_threshold(x, y):\\n        return (x or y) and x**2 + y**2 > self.threshold_radius ** 2\\n\\n    def angle_diff(a, b):\\n        \\\"\\\"\\\"Signed difference between 2 angles.\\\"\\\"\\\"\\n        f = (a - b) % math.tau\\n        g = (b - a) % math.tau\\n        return -f if f < g else g\\n\\n    def reset(self):\\n        self.position = (0, 0)\\n        self.stack = []\\n        self.active = False\\n        self.dialing = False\\n        self.start_angle = 0\\n        self.reset_sector_counts()\\n\\n    def reset_sector_counts(self):\\n        self.sector_counts = [0 for _ in range(8)]\\n\\n    def dump(self):\\n        return {'position': self.position, 'angle': self.angle_from_coordinates(*self.position)}\\n\\n    def update(self, x, y):\\n        self.position = (x, y)\\n        if test_threshold(x, y):\\n            angle = angle_from_coordinates(x, y)\\n            if not self.active:\\n                self.start_pos = (x, y)\\n                self.start_angle = angle_from_coordinates(x, y)\\n                self.active = True\\n            if not self.dialing:\\n                if abs(self.angle_diff(angle, self.start_angle)) > self.dialing_threshold:\\n                    self.stack.append(get_sector_4(*self.start_pos))\\n                    self.dialing = True\\n            if self.dialing:\\n                sector = get_sector_4(x, y)\\n                # Prevent repeated sectors & back and forth between 2 neighboring sectors\\n                # otherwise slightly inaccurate inputs will lead to multiple crossings of the\\n                # sector boundary\\n                if (self.stack and sector != self.stack[-1] and\\n                    (len(self.stack) < 2 or sector != self.stack[-2])) or not self.stack:\\n                    self.stack.append(sector)\\n            else:\\n                sector = get_sector_8(x, y)\\n                self.sector_counts[sector] += 1\\n        elif self.active:\\n            self.active = False\\n            if not self.dialing:\\n                max_sector, count = max(enumerate(self.sector_counts), key=operator.itemgetter(1))\\n                if count:\\n                    self.stack.append(max_sector)\\n            else:\\n                self.dialing = False\\n            self.reset_sector_counts()\\n\\n\", \"name\": \"DovDial\"}", "created_at": null, "updated_at": 1754736945.4949286}