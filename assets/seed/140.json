{"id": "140", "type": "class", "data": "{\"code_str\": \"import re, ast\\n\\nclass ClassView:\\n    def __init__(self, cls, instance=None, focus_parent=world.focus, max_lines=20, min_lines=20):\\n        self.cls = cls\\n        self.instance = instance\\n        self.focus = focus_parent.add_child(self)\\n        self.name = z.ReactiveValue(self.make_name())\\n        actions = [\\n            ('get code', self.get_code_view_triggered),\\n            ('edit', self.edit_triggered),\\n            ('reset', self.reset_triggered),\\n            ('launch as floatie', self.launch_triggered),\\n            ('delete', self.delete_triggered)\\n        ]\\n        self.project_id_input = z.Input(text=str(self.cls['project_id']), focus_parent=self.focus)\\n        self.project_id_input.submitted.connect(self.project_id_submitted)\\n        self.kernel_input = z.Input(text=str(self.cls['kernel']), focus_parent=self.focus)\\n        self.kernel_input.submitted.connect(self.kernel_submitted)\\n        self.actions_panel = world.classes.get_class(name='ActionsPanel')(actions, focus_parent=self.focus)\\n        self.row = z.Flex([z.FlexChild(self.project_id_input.layout),\\n                           z.FlexChild(self.kernel_input.layout),\\n                           z.FlexChild(self.actions_panel.layout)],\\n                           yalign='largest')\\n        self.input = z.Input(text=self.cls['code'], focus_parent=self.focus, tabs=True, multiline=True, max_lines=max_lines, min_lines=min_lines, syntax_coloring=True)\\n        self.input.submitted.connect(self.input_submitted)\\n        self.column = z.Flex([z.FlexChild(self.row.layout), z.FlexChild(self.input.layout, flex=1)], axis='y', xalign='largest')\\n        self.layout = self.column.layout\\n\\n        self.changed = z.Signal()\\n\\n        world.focus.set_focus(self.input.focus)\\n\\n    def make_name(self):\\n        return f\\\"class: {self.cls['name']}\\\"\\n\\n    def project_id_submitted(self):\\n        value = int(self.project_id_input.text)\\n        world.classes.update_class_code(self.cls['id'], project_id=value)\\n        self.cls['project_id'] = value\\n\\n    def kernel_submitted(self):\\n        value = int(self.kernel_input.text)\\n        world.classes.update_class_code(self.cls['id'], kernel=value)\\n        self.cls['kernel'] = value\\n\\n    #def update_instance(self):\\n    #    if self.instance:\\n    #        self.instance.__class__ = world.classes[self.cls['name']]\\n\\n    def input_submitted(self):\\n        new_code_str = self.input.text.strip()\\n        ast.parse(new_code_str)\\n        new_name = self.scrape_class_name(new_code_str) or self.cls['name']\\n        # side effect in update_class_code updates self.cls\\n        world.classes.update_class_code(self.cls['id'], code_str=new_code_str, new_name=new_name)\\n        self.name.set(self.make_name())\\n        #self.update_instance()\\n        self.changed.emit(self.cls)#world.classes[self.cls['name']])\\n\\n    #def method_code_submitted(self, method, new_code_str):\\n    #    new_func = ast.parse(new_code_str).body[0]\\n    #    for n in self.tree.body:\\n    #        if isinstance(n, ast.ClassDef):\\n    #            for (i, nn) in enumerate(n.body):\\n    #                if nn is method:\\n    #                    n.body[i] = new_func\\n    #                    break\\n    #    self.cls['code'] = ast.unparse(self.tree)\\n    #    world.classes.update_class_code(self.cls['id'], code_str=self.cls['code'])\\n    #    self.update_methods()\\n\\n    def reset_triggered(self):\\n        world.classes.reset_class(self.cls['id'])\\n\\n    def scrape_class_name(self, text):\\n        m = re.search('class\\\\\\\\s+(\\\\\\\\w+)\\\\\\\\s*(\\\\\\\\(.*\\\\\\\\))?:', text)\\n        return m.group(1) if m else None\\n\\n    def get_code_view_triggered(self):\\n        CodeView = world.classes.get_class(name='CodeView')\\n        world.floaties.add(CodeView(world.classes.codes[self.cls['id']]))\\n\\n    def launch_triggered(self):\\n        world.floaties.add(world.classes.get_class(self.cls['id'])())\\n\\n    def delete_triggered(self):\\n        world.classes.delete_class_code(self.cls['id'])\\n        world.floaties.drop_obj(self)\\n\\n    def edit_triggered(self):\\n        new_code_str = world.dialogs.edit_string(self.cls['code'], file_suffix='.py').strip()\\n        try:\\n            ast.parse(new_code_str)\\n            new_name = self.scrape_class_name(new_code_str)\\n            self.cls['code'] = new_code_str\\n            self.cls['name'] = new_name if new_name else self.cls['name']\\n            world.classes.update_class_code(self.cls['id'], code_str=self.cls['code'], new_name=self.cls['name'])\\n            self.name.set(self.make_name())\\n            self.input.set_text(self.cls['code'])\\n            #self.update_instance()\\n        except Exception as e:\\n            world.floaties.add(z.PyErrorView(e))\\n\\n    def drop(self):\\n        self.column.drop()\\n        self.row.drop()\\n        self.actions_panel.drop()\\n        self.project_id_input.drop()\\n        self.kernel_input.drop()\\n        self.input.drop()\\n        self.focus.drop()\\n\", \"name\": \"ClassView\"}", "created_at": null, "updated_at": 1756754129.7311978}