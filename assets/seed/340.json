{"id": "340", "type": "class", "data": "{\"code_str\": \"import warnings\\nimport sdl2.ext\\nimport subprocess\\nimport glob\\nimport ctypes\\nfrom collections import defaultdict\\n\\n# TODO https://github.com/alanrme/ds4led/tree/master\\n\\nclass Gamepad:\\n    def __init__(self, joystick_device_index):\\n        self.controller = sdl2.SDL_GameControllerOpen(joystick_device_index)\\n        self.joystick = sdl2.SDL_GameControllerGetJoystick(self.controller)\\n        self.sdl_id = sdl2.SDL_JoystickInstanceID(self.joystick)\\n        self.name = sdl2.SDL_GameControllerName(self.controller).decode('utf-8')\\n        self.serial = None#sdl2.SDL_GameControllerGetSerial(self.controller)\\n        self.mac_address = None\\n        if self.serial is not None:\\n            self.serial = self.serial.decode()\\n            self.mac_address = self.serial.replace('-', ':')\\n\\n        # https://github.com/wogscpar/upower-python/blob/master/upower_python/upower.py TODO\\n\\n        self.pressed = defaultdict(int)\\n\\n        self.button_down = z.Signal()\\n        self.button_up = z.Signal()\\n        self.motion = z.Signal()\\n\\n    def dump(self):\\n        return dict(sdl_id=self.sdl_id, name=self.name, mac_address=self.mac_address,\\n                    power_level=self.get_power_level())\\n\\n    def get_joystick(self):\\n        return sdl2.SDL_GameControllerGetJoystick(self.controller)\\n\\n    def is_present(self):\\n        return sdl2.SDL_GameControllerGetAttached(self.controller)\\n\\n    def get_name(self):\\n        return sdl2.SDL_GameControllerName(self.controller).decode('utf-8')\\n\\n    def rumble(self, low, high, duration):\\n        sdl2.SDL_GameControllerRumble(self.controller, low, high, duration)\\n\\n    def get_axes(self, start=None, end=None, threshold=0.1):\\n        axes = [sdl2.SDL_GameControllerGetAxis(self.controller, i) for i in range(start or 0, end or sdl2.SDL_CONTROLLER_AXIS_MAX)]\\n        # Normalize SDL's -32768 to 32767 range to -1.0 to 1.0\\n        axes = np.array(axes, dtype=np.float32) / 32768.0\\n        axes = np.where((axes < threshold) & (axes > -threshold), 0, axes)\\n        return axes\\n\\n    def normalize_axis_value(self, value):\\n        return np.float32(value) / 32768.0\\n\\n    def set_led_color(self, color):\\n        if hasattr(sdl2, 'SDL_GameControllerSetLED'):\\n            sdl2.SDL_GameControllerSetLED(\\n                self.controller, *(np.asarray(color) * 255).astype('int'))\\n\\n    def get_power_level(self):\\n        if self.mac_address:\\n            return int(subprocess.check_output(['cat', glob.glob(f'/sys/class/power_supply/*controller*{self.mac_address}/capacity')[0]]))\\n        #return sdl2.SDL_JoystickCurrentPowerLevel(self.joystick)\\n\\n    def disconnect(self):\\n        if not self.mac_address:\\n            warnings.warn('Can\\\\'t disconnect gamepad, no mac address available')\\n            return\\n        subprocess.check_output(['bluetoothctl',  'disconnect',  self.mac_address])\\n\\n    def get_buttons(self):\\n        buttons = [sdl2.SDL_GameControllerGetButton(self.controller, i) for i in range(sdl2.SDL_CONTROLLER_BUTTON_MAX)]\\n        return np.array(buttons, dtype=np.int32)\\n\\n    def enable_gyro(self):\\n        sdl2.SDL_GameControllerSetSensorEnabled(self.controller, sdl2.SDL_SENSOR_GYRO, 1)\\n\\n    def enable_accel(self):\\n        sdl2.SDL_GameControllerSetSensorEnabled(self.controller, sdl2.SDL_SENSOR_ACCEL, 1)\\n\\n    def has_gyro(self):\\n        return bool(sdl2.SDL_GameControllerHasSensor(self.controller, sdl2.SDL_SENSOR_GYRO))\\n\\n    def has_accel(self):\\n        return bool(sdl2.SDL_GameControllerHasSensor(self.controller, sdl2.SDL_SENSOR_ACCEL))\\n\\n    def get_gyro(self):\\n        data = np.zeros((3,), dtype=np.float32)\\n        p = data.ctypes.data_as(ctypes.POINTER(ctypes.c_float))\\n        sdl2.SDL_GameControllerGetSensorData(self.controller, sdl2.SDL_SENSOR_GYRO, p, 3)\\n        return data\\n\\n    def get_accel(self):\\n        data = np.zeros((3,), dtype=np.float32)\\n        p = data.ctypes.data_as(ctypes.POINTER(ctypes.c_float))\\n        sdl2.SDL_GameControllerGetSensorData(self.controller, sdl2.SDL_SENSOR_ACCEL, p, 3)\\n        return data\\n\\n    def drop(self):\\n        sdl2.SDL_GameControllerClose(self.controller)\\n\", \"name\": \"Gamepad\"}", "created_at": null, "updated_at": 1754736945.486616}