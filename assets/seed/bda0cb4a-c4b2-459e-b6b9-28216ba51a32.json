{"id": "bda0cb4a-c4b2-459e-b6b9-28216ba51a32", "type": "class", "data": "{\"code_str\": \"class LLMConversationEntity(z.Entity):\\n    def __init__(self, id, title, temperature, max_tokens):\\n        super().__init__('llm-conversation', id)\\n        self.title = title\\n        self.temperature = temperature\\n        self.max_tokens = max_tokens\\n        self.view = z.LLMConversationEntityView\\n        self.preview = z.LLMConversationEntityPreview\\n        self.color = [0.9521337793457223, 0.4603437382113039, 0.005419754066727123, 1.0]\\n        self.label = self.title\\n\\n    @classmethod\\n    def create(cls, title='', temperature=0.6, max_tokens=1024, id=None):\\n        id = super().create(\\n            'llm-conversation',\\n            {'title': title, 'temperature': temperature, 'max_tokens': max_tokens},\\n            id=id\\n        )\\n        return cls(id, title)\\n\\n    @classmethod\\n    def load(cls, id, data):\\n        return cls(id, data['title'], data.get('temperature', 0.6), data.get('max_tokens', 1024))\\n\\n    def clone(self):\\n        return LLMConversationEntity.create(title=self.title, temperature=self.temperature, max_tokens=self.max_tokens)\\n\\n    def dump_data(self):\\n        return {'title': self.title, 'temperature': self.temperature, 'max_tokens': self.max_tokens}\\n\\n    def get_message_entities(self):\\n        messages = []\\n        n = self\\n        while True:\\n            edges = G.get_outgoing(n)\\n            entities = [z.Entity.get(x['target_id']) for x in edges]\\n            llm_message_entities = [x for x in entities if x.type == 'llm-message']\\n            if llm_message_entities:\\n                assert len(llm_message_entities) == 1\\n                target_entity = llm_message_entities[0]\\n                messages.append(target_entity)\\n                n = target_entity\\n            else:\\n                break\\n        return messages\\n\\n    def send(self):\\n        world.aio.create_task(self.send_async())\\n\\n    async def send_async(self):\\n        message_entities = self.get_message_entities()\\n        messages = []\\n        system = ''\\n        for e in message_entities:\\n            if e.role == 'system':\\n                system += '\\\\n' + e.content\\n            else:\\n                messages.append({\\n                    'role': e.role,\\n                    'content': e.content\\n                })\\n        response = await world.apps['Claude'].send(\\n            messages=messages, system=system, max_tokens=self.max_tokens,\\n            temperature=self.temperature)\\n        for item in response.content:\\n            if item.type == 'text':\\n                new_entity = z.LLMMessageEntity.create(content=item.text,\\n                                                       role=response.role)\\n                G.add_node(new_entity)\\n                G.add_edge(e, new_entity)\\n        G.save()\\n\", \"name\": \"LLMConversationEntity\"}", "created_at": 1753255824.8379412, "updated_at": 1754239007.5071862}