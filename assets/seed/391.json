{"id": "391", "type": "class", "data": "{\"code_str\": \"import time\\nimport random\\nfrom collections import deque, defaultdict\\n\\nfrom force_layout import ForceLayout as CppForceLayout\\n\\n\\nclass ForceLayout:\\n    def __init__(self, dimensions=2, update_interval=0.1,\\n                 spring_rest_length = 50,\\n                 repulsive_force_constant = 6250,\\n                 spring_constant = 1,\\n                 delta_t = 0.02,\\n                 center_force=0.0001,\\n                 stabilized_max_displacement=0.02,\\n                 stabilized_avg_displacement=0.01,\\n                 max_displacement_squared = 100):\\n        self.position = np.array((0, 500, 0), float)\\n        self.dimensions = dimensions\\n        self.update_interval = update_interval\\n        self.spring_rest_length = spring_rest_length\\n        self.repulsive_force_constant = repulsive_force_constant\\n        self.spring_constant = spring_constant\\n        self.delta_t = delta_t\\n        self.max_displacement_squared = max_displacement_squared\\n        self.center_force = center_force\\n        self.stabilized_max_displacement = 0.02\\n        self.stabilized_avg_displacement = 0.01\\n\\n        self.active = False\\n        self.results = 0, 0, 0\\n\\n        self.cpp_force_layout = CppForceLayout(\\n            dimensions=self.dimensions,\\n            spring_rest_length=self.spring_rest_length,\\n            repulsive_force_constant=self.repulsive_force_constant,\\n            spring_constant=self.spring_constant,\\n            delta_t=self.delta_t,\\n            center_force=self.center_force,\\n            center_position=self.position,\\n            max_displacement_squared=self.max_displacement_squared,\\n        )\\n\\n        self.clear()\\n\\n        self.stabilized = z.Signal()\\n        self.changed = z.Signal()\\n\\n    def update_params(self):\\n        self.cpp_force_layout.repulsive_force_constant = self.repulsive_force_constant\\n        self.cpp_force_layout.spring_rest_length = self.spring_rest_length\\n        self.cpp_force_layout.spring_constant = self.spring_constant\\n        self.cpp_force_layout.max_displacement_squared = self.max_displacement_squared\\n        self.cpp_force_layout.center_force = self.center_force\\n        self.cpp_force_layout.delta_t = self.delta_t\\n\\n    def clear(self):\\n        self.cpp_force_layout.clear()\\n\\n    def add_node(self, position):\\n        return self.cpp_force_layout.add_node(np.asarray(position, float))\\n\\n    def add_edge(self, source, target, mirror=True):\\n        self.cpp_force_layout.add_edge(source, target, mirror)\\n\\n    def set_position(self, index, position):\\n        self.cpp_force_layout.set_position(index, position)\\n\\n    def start(self, callback=None):\\n        self.callback = callback\\n        self.last_update = None\\n        self.active = True\\n        self.changed.emit()\\n\\n    def update(self, num_iterations=1000):\\n        if not self.active:# or not self.positions.size:\\n            return\\n\\n        self.results = self.cpp_force_layout.step(num_iterations)\\n\\n        self.positions = self.cpp_force_layout.get_positions()\\n\\n        total_displacement, average_displacement, max_displacement = self.results\\n\\n        if average_displacement < self.stabilized_avg_displacement and max_displacement < self.stabilized_max_displacement:\\n            self.stop()\\n            self.stabilized.emit()\\n\\n    def cancel(self):\\n        self.active = False\\n        self.changed.emit()\\n\\n    def stop(self):\\n        self.active = False\\n        if self.callback is not None:\\n            self.callback()\\n        self.changed.emit()\\n\\n    def until_stable(self, timeout=10):\\n        t0 = time.time()\\n        self.start()\\n        while self.active:\\n            self.update(1)\\n            if time.time() - t0 > timeout:\\n                self.stop()\\n\\n    def run(self, callback=None):\\n        if self.active:\\n            self.active = False\\n        self.start(callback)\\n\\n    def drop(self):\\n        self.clear()\\n\", \"name\": \"ForceLayout\"}", "created_at": null, "updated_at": 1751906432.7395563}